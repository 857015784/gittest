#
# Minimal Sphinx configuration sample (clean, simple, functional)
#
#31 20  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress --rotate
#41 20  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress_ja --rotate
#51 20  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress_fr --rotate
#31 0  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress --rotate
#41 0  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress_fr --rotate
#51 0  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress_ja --rotate
#31 3  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress --rotate
#41 3  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress_fr --rotate
#51 3  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress_ja --rotate
#31 5  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress --rotate
#41 5  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress_fr --rotate
#51 5  * * * /usr/local/ver01/sphinx/bin/indexer --config /usr/local/ver01/sphinx/etc/sammydress.conf  sammydress_ja --rotate

source brid_keywords
{
        type                                    = mysql
 
        sql_host                                = 192.168.3.242
        sql_user                                = root
        sql_pass                                = qazwsx
        sql_db                                  = bridalpure_20140509
       #sql_sock                          =  /usr/local/ver01/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query				= \
select g.goods_id,is_24h_ship,g.goods_sn,g.brand,g.original_sn, g.goods_title, g.goods_name, g.goods_brief, g.add_time,g.last_update, g.sort_order, g.group_goods_id, g.point_rate, \
                       g.is_free_shipping, g.is_hot,g.is_new, g.is_promote, g.week2sale, g.click_count, g.shop_price, g.is_login, g.cat_id,(if(goods_number=0 OR is_on_sale = 0 OR is_delete = 1,0,1)) as goods_number, gc.conversion_rate,gc.conversion_rate2,ge.goods_grade, \
(if(is_on_sale = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(ga.attr_value separator ' ')) AS goods_title_color_size, \
                       ge.review_count AS reviews, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr, \
                       CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order,if(g.brand<>'' AND original_sn<>'',1,0) AS has_brand \
,IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_promote=1, 1, 0) AS is_pro \
                FROM eload_goods as g \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
		LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
                WHERE g.is_alone_sale = 1 AND g.goods_thumb != '' GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = last_update 
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint   = has_brand
sql_attr_uint    =goods_grade
sql_attr_uint    =is_pro
sql_attr_uint    = goods_number
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint    = is_hot
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    =is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
}

index brid_keywords
{
    source               =  brid_keywords
    path                 = /usr/local/sphinx/var/data/brid
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,brand,original_sn,goods_attr
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D
}


searchd
{
	port					= 9315
	log						= /usr/local/sphinx/var/log/brid_searchd.log
	query_log				= /usr/local/sphinx/var/log/brid_query.log
	read_timeout			= 5
	max_children			= 30
	pid_file				= /usr/local/sphinx/var/log/brid_searchd.pid
	 binlog_path             =
      compat_sphinxql_magics  = 0
        max_matches				= 10001 
	seamless_rotate			= 1
	preopen_indexes			= 0
	unlink_old				= 1

}

