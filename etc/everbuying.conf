source everbuying_v2 {
    type                    = mysql
    sql_host                = 192.168.6.71
    sql_user                = root
    sql_pass                = NvGHHsQvo3!90YS@
    sql_db                  = everbuying_db
    sql_port                = 3306
    mysql_connect_flags     = 32    
    
	sql_query_pre           = SET NAMES utf8
    sql_query               = SELECT * FROM view_sphinx_goods
    sql_query_pre           = REPLACE INTO eload_sphinx_counter SELECT 'everbuying_v2',MAX(goods_id),UNIX_TIMESTAMP() FROM eload_goods
    sql_query_post_index    = CALL sphinx_goods_sql_query_post_index('everbuying_v2', 'everbuying_v2')
    sql_attr_float       = conversion_rate2
	
    #sql_attr_uint        = last_update
    sql_attr_uint        = review_rate
    sql_attr_uint        = hot_order
    sql_attr_uint        = is_60days
    sql_attr_uint        = shelf_down_type
    sql_attr_uint        = clearance_discount
    sql_attr_uint        = clearance_date
    sql_attr_uint        = is_24h_ship
    sql_attr_float       = conversion_rate
    sql_attr_uint        = sort_order
    sql_attr_timestamp   = add_time
    sql_attr_uint        = add_date
    sql_attr_uint        = group_goods_id
    sql_attr_uint        = goods_number
    sql_attr_uint        = is_delete
    sql_attr_uint        = cat_id
    sql_field_string     = goods_title
    sql_attr_string      = url_title
    sql_attr_float       = shop_price
    sql_attr_uint        = is_on_sale
    sql_attr_uint        = is_login
    sql_attr_uint        = sale_number
	sql_attr_uint        = week2sale
    sql_attr_uint        = newordervalue
    sql_attr_uint        = reviews
    sql_attr_string      = substr7_goods_sn
    sql_attr_string      = goods_img
    sql_attr_string      = goods_thumb
    sql_attr_uint        = promote_start_date
    sql_attr_uint        = promote_end_date
    sql_attr_float       = promote_price
    sql_attr_float       = market_price
    sql_attr_uint        = goods_grade
    sql_attr_timestamp   = sale_time
    sql_attr_uint        = sale_date
    sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
    sql_attr_uint        = is_tuijian
    sql_attr_uint        = is_promote
    sql_attr_uint 	     = is_shenzhen
    sql_attr_uint 	     = is_hongkong
    sql_attr_uint 	     = back_date_from

}

source everbuying_keywords {
    type                    = mysql
    sql_host                = 192.168.6.71
    sql_user                = root
    sql_pass                = NvGHHsQvo3!90YS@
    sql_db                  = everbuying_db

    sql_query_pre           = SET NAMES utf8
    sql_query_pre           = REPLACE INTO eload_sphinx_counter SELECT 'everbuying_keywords',MAX(last_update_time),UNIX_TIMESTAMP() FROM eload_abc_index_keywords_new2
    sql_query               = \
                            SELECT keyword_id,SUBSTRING(keyword,1,1) AS first_letter,keyword,cat_id,top_cat_id,goods_num,IF(word_count>5, 5, word_count) AS word_count,0 AS is_delete\
                            FROM eload_abc_index_keywords_new2
    sql_query_info          = SELECT * FROM eload_abc_index_keywords_new2 WHERE keyword_id=$id
    sql_query_post_index    = CALL sphinx_sql_query_post_index('everbuying_keywords', 'everbuying_keywords')

    sql_attr_uint           = cat_id
    sql_attr_uint           = top_cat_id
    sql_attr_uint           = word_count
    sql_attr_uint           = is_delete
    sql_field_string         = keyword
    sql_attr_uint           = goods_num
}

source everbuying_keywords_delta : everbuying_keywords {
    sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='everbuying_keywords'
    sql_query_post_index    = CALL sphinx_sql_query_post_index('everbuying_keywords', 'everbuying_keywords_delta')
    sql_query               = \
                            SELECT keyword_id,SUBSTRING(keyword,1,1) AS first_letter,keyword,cat_id,top_cat_id,goods_num,IF(word_count>5, 5, word_count) AS word_count,0 AS is_delete\
                            FROM eload_abc_index_keywords_new2\
                            WHERE last_update_time>(SELECT last_time FROM eload_sphinx_counter WHERE index_name='everbuying_keywords')
}

index everbuying_v2 {
    source                  = everbuying_v2
    path                    = /usr/local/sphinx/var/data/everbuying_v2
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,keywords,color_size,add_time
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E

}

index everbuying_keywords {
    source                  = everbuying_keywords
    path                    = /usr/local/sphinx/var/data/everbuying_keywords
    charset_table           = 0..9, A..Z->a..z, _, a..z, .
    charset_type            = utf-8

}

index everbuying_keywords_delta : everbuying_keywords {
    source                  = everbuying_keywords_delta
    path                    = /usr/local/sphinx/var/data/everbuying_keywords_delta
}

indexer {
        mem_limit           = 512M
}


searchd {
    listen                  = 9313
   # listen                  = 9306:mysql41
    log                     = /usr/local/sphinx/var/log/everbuying_searchd.log
    query_log               = /usr/local/sphinx/var/log/everbuying_query.log
    pid_file                = /usr/local/sphinx/var/log/everbuying_searchd.pid
    read_timeout            = 5
    max_children            = 30
    max_matches             = 2500
    seamless_rotate         = 1
    preopen_indexes         = 0
    unlink_old              = 1
    binlog_path             =
    compat_sphinxql_magics  = 0
}

#/usr/local/ver01/sphinx208/bin/indexer --config /usr/local/ver01/sphinx208/etc/everbuying.conf --all --rotate
#/usr/local/ver01/sphinx208/bin/searchd --config /usr/local/ver01/sphinx208/etc/everbuying.conf
#/usr/local/ver01/sphinx208/bi:/indexer indexer --merge everbuying_keywords everbuying_keywords_delta --merge-dst-range is_delete 0 0 --config /usr/local/ver01/sphinx208/etc/everbuying.conf --rotate
