##############rosegal
source rosegal_com
{
        type                                    = mysql

        sql_host                                = 10.60.46.193
        sql_user                                = sphinx_user
        sql_pass                                = kwsYU53ukPEAuu
        sql_db                                  = rosegal_db
        #sql_sock                          =  /usr/local/ver04/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale, IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
g.week1sale_spu,g.week2sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution,IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',gfr.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 REPLACE(gfr.goods_search_attr,',','') AS goods_search_attr_test, \
((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and en_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and en_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,gfr.goods_search_attr, \
   gfr.goods_title, gfr.goods_name,gfr.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,(IF(g.model_id>0,1,0)) AS is_has_model,ge.goods_brand,(IF(gfr.goods_title IS NULL,0,1)) AS has_goods_fr,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                LEFT JOIN `eload_goods_fr` AS `gfr` ON((`gfr`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                INNER JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'en' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'en' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' GROUP BY g.goods_id
sql_attr_timestamp   = add_time
sql_attr_timestamp   = on_sale_time
sql_attr_uint    = is_24h_ship
sql_attr_uint    = is_blacklist_app
sql_attr_uint    = is_on_sale_sites
sql_attr_uint    = is_on_sale_app

sql_attr_uint   = sort_order
sql_attr_uint   = img_type_order

sql_attr_float    = overall_rate

sql_attr_uint    = goods_amount
sql_attr_uint    = goods_number
sql_attr_uint    = group_goods_id
sql_attr_uint    = group_color_goods_id
sql_attr_uint    = goods_id1
sql_field_string = goods_sn
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint	 = is_new_promote
sql_attr_uint    = is_hot
sql_attr_uint    = img_type
sql_attr_bigint   = promote_start_date
sql_attr_bigint   = promote_end_date
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = day3sale
sql_attr_float    = cxj
sql_attr_float    = week2sale_price
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint   = week1sale_spu
sql_attr_uint   = week2sale_spu
sql_attr_uint   = zhekou
sql_attr_uint    = is_login
sql_attr_uint    = is_new
sql_attr_uint    = is_deals
sql_attr_float   = goods_weight
sql_attr_bigint  = seo_id
sql_attr_uint    = cat_id
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_bigint    = new_goods_weight
#sql_field_string = goods_attr
#sql_attr_string = goods_attr
sql_field_string = goods_url_title
#sql_attr_string = goods_url_title
sql_attr_uint = attention_num
sql_attr_uint    = shelf_down_type
sql_attr_bigint   = first_on_sale_time
sql_attr_bigint   = last_on_sale_time
sql_attr_uint    = is_distribution
sql_attr_uint    = ship_distribution
sql_attr_float    = clearance_discount
sql_attr_float    = recommendation
sql_attr_uint   = recommended_level
sql_field_string = goods_model
sql_attr_float    =promote_price
sql_attr_uint    =shelf_down_type_unsalable
sql_attr_uint    = unsalable
sql_attr_uint    = week1sale
sql_attr_float    = week1sale_price
sql_attr_uint    = has_goods_brand
sql_attr_uint    = is_dressfo_brand
sql_attr_uint    = is_nextmia_brand
sql_attr_uint    = is_has_model
sql_attr_uint    = available_stock
sql_attr_uint    = real_time_number
sql_attr_uint    = is_sample_making
sql_attr_uint    = is_bf
sql_attr_uint    = label_level
sql_attr_bigint   = update_time
sql_attr_multi       = uint disabled_country_code from field disabled_country_code
sql_attr_multi       = uint on_sale_country from field on_sale_country
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint label_id_all from query; SELECT goods_id,label_id FROM eload_goods_label
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

source rosegal_com_delta : rosegal_com {
	sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='rosegal_com'
	sql_query = \
	SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale, IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
g.week1sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution,IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',gfr.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 REPLACE(gfr.goods_search_attr,',','') AS goods_search_attr_test, \
((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and en_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and en_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,gfr.goods_search_attr, \
   gfr.goods_title, gfr.goods_name,gfr.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,(IF(g.model_id>0,1,0)) AS is_has_model,ge.goods_brand,(IF(gfr.goods_title IS NULL,0,1)) AS has_goods_fr,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                LEFT JOIN `eload_goods_fr` AS `gfr` ON((`gfr`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                INNER JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'en' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'en' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' \
				AND g.update_time > (SELECT FROM_UNIXTIME(last_time) FROM eload_sphinx_counter WHERE index_name='rosegal_com') \
				GROUP BY g.goods_id
	sql_query_post = UPDATE eload_sphinx_counter SET last_time=(SELECT UNIX_TIMESTAMP(MAX(update_time)) FROM eload_goods) WHERE index_name='rosegal_com'
}

index rosegal
{
    source               =  rosegal_com
    path                 = /usr/local/sphinx/var/data/rosegal_com
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,goods_search_attr_test,goods_brand
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E
}
##############rosegal end

index rosegal_delta : rosegal {
    source                  = rosegal_com_delta
    path                    = /usr/local/sphinx/var/data/rosegal_com_delta
}

##############rosegal_fr
source rosegal_com_fr
{
        type                                    = mysql

        sql_host                                = 10.60.46.193
        sql_user                                = sphinx_user
        sql_pass                                = kwsYU53ukPEAuu
        sql_db                                  = rosegal_db
        #sql_sock                          =  /usr/local/ver04/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
		sql_query_pre = SET NAMES utf8
		sql_query_pre = REPLACE INTO eload_sphinx_counter SELECT 'rosegal_com_fr',UNIX_TIMESTAMP(MAX(update_time)),UNIX_TIMESTAMP() FROM eload_goods
        sql_query                               = \
SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale,IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution, IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',gfr.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
					   g.week1sale_spu,g.week2sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 CONCAT_WS(' ',gfr.goods_title,GROUP_CONCAT(gal.attr_value_lang SEPARATOR ' ')) AS goods_lang_title_color_size, \
 REPLACE(gfr.goods_search_attr,',','') AS goods_search_attr_test, \
((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and fr_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and fr_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,gfr.goods_search_attr, \
   gfr.goods_title, gfr.goods_name,gfr.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,ge.goods_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,(IF(gfr.goods_title IS NULL,0,1)) AS has_goods_fr,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                JOIN `eload_goods_fr` AS `gfr` ON((`gfr`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                INNER JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'fr' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'fr' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' GROUP BY g.goods_id
sql_attr_timestamp   = add_time
sql_attr_timestamp   = on_sale_time
sql_attr_uint    = is_24h_ship
sql_attr_uint    = is_blacklist_app
sql_attr_uint    = is_on_sale_sites
sql_attr_uint    = is_on_sale_app


sql_attr_uint   = sort_order
sql_attr_uint   = img_type_order

sql_attr_float    = overall_rate

sql_attr_uint    = goods_amount
sql_attr_uint    = goods_number
sql_attr_uint    = group_goods_id
sql_attr_uint    = group_color_goods_id
sql_attr_uint    = goods_id1
sql_field_string = goods_sn
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint    = is_new_promote
sql_attr_uint    = is_hot
sql_attr_uint    = img_type
sql_attr_bigint   = promote_start_date
sql_attr_bigint   = promote_end_date
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = day3sale
sql_attr_float    = cxj
sql_attr_float    = week2sale_price
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint   = week1sale_spu
sql_attr_uint   = week2sale_spu
sql_attr_uint   = zhekou
sql_attr_uint    = is_login
sql_attr_uint    = is_new
sql_attr_uint    = is_deals
sql_attr_float   = goods_weight
sql_attr_bigint  = seo_id
sql_attr_uint    = cat_id
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_bigint    = new_goods_weight
#sql_field_string = goods_attr
#sql_attr_string = goods_attr
sql_field_string = goods_url_title
#sql_attr_string = goods_url_title
sql_attr_uint = attention_num
sql_attr_uint    = shelf_down_type
sql_attr_bigint   = first_on_sale_time
sql_attr_bigint   = last_on_sale_time
sql_attr_uint    = is_distribution
sql_attr_uint    = ship_distribution
sql_attr_float    = clearance_discount
sql_attr_float    = recommendation
sql_attr_uint   = recommended_level
sql_field_string = goods_model
sql_attr_float    =promote_price
sql_attr_uint    =shelf_down_type_unsalable
sql_attr_uint    = unsalable
sql_attr_uint    = week1sale
sql_attr_float    = week1sale_price
sql_attr_uint    = has_goods_brand
sql_attr_uint    = is_dressfo_brand
sql_attr_uint    = is_nextmia_brand
sql_attr_uint    = has_goods_fr
sql_attr_uint    = available_stock
sql_attr_uint    = real_time_number
sql_attr_uint    = is_sample_making
sql_attr_uint    = is_bf
sql_attr_uint    = label_level
sql_attr_bigint   = update_time
sql_attr_multi       = uint disabled_country_code from field disabled_country_code
sql_attr_multi       = uint on_sale_country from field on_sale_country
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint label_id_all from query; SELECT goods_id,label_id FROM eload_goods_label
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

source rosegal_com_fr_delta : rosegal_com_fr {
	sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='rosegal_com_fr'
	sql_query = \
	SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale,IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution, IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',gfr.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
					   g.week1sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 CONCAT_WS(' ',gfr.goods_title,GROUP_CONCAT(gal.attr_value_lang SEPARATOR ' ')) AS goods_lang_title_color_size, \
 REPLACE(gfr.goods_search_attr,',','') AS goods_search_attr_test, \
((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and fr_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and fr_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,gfr.goods_search_attr, \
   gfr.goods_title, gfr.goods_name,gfr.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,ge.goods_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,(IF(gfr.goods_title IS NULL,0,1)) AS has_goods_fr,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                JOIN `eload_goods_fr` AS `gfr` ON((`gfr`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                INNER JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'fr' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'fr' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' \
				AND g.update_time > (SELECT FROM_UNIXTIME(last_time) FROM eload_sphinx_counter WHERE index_name='rosegal_com_fr') \
				GROUP BY g.goods_id
	sql_query_post = UPDATE eload_sphinx_counter SET last_time=(SELECT UNIX_TIMESTAMP(MAX(update_time)) FROM eload_goods) WHERE index_name='rosegal_com_fr'
}

index rosegal_fr
{
    source               =  rosegal_com_fr
    path                 = /usr/local/sphinx/var/data/rosegal_com_fr
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,goods_search_attr_test,goods_lang_title_color_size,goods_brand
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}
##############rosegal_fr end

index rosegal_fr_delta : rosegal_fr {
    source                  = rosegal_com_fr_delta
    path                    = /usr/local/sphinx/var/data/rosegal_com_fr_delta
}

##############rosegal_ru
source rosegal_com_ru
{
        type                                    = mysql

        sql_host                                = 10.60.46.193
        sql_user                                = sphinx_user
        sql_pass                                = kwsYU53ukPEAuu
        sql_db                                  = rosegal_db
        #sql_sock                          =  /usr/local/ver04/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale,IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution,IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',gru.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
					   g.week1sale_spu,g.week2sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 CONCAT_WS(' ',gru.goods_title,GROUP_CONCAT(gal.attr_value_lang SEPARATOR ' ')) AS goods_lang_title_color_size, \
 REPLACE(gru.goods_search_attr,',','') AS goods_search_attr_test, \
 ((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and ru_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and ru_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,gru.goods_search_attr, \
   gru.goods_title, gru.goods_name,gru.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,ge.goods_brand,(IF(gru.goods_title IS NULL,0,1)) AS has_goods_ru,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                JOIN `eload_goods_ru` AS `gru` ON((`gru`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                LEFT JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'ru' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'ru' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' GROUP BY g.goods_id
sql_attr_timestamp   = add_time
sql_attr_timestamp   = on_sale_time
sql_attr_uint    = is_24h_ship
sql_attr_uint    = is_blacklist_app
sql_attr_uint    = is_on_sale_sites
sql_attr_uint    = is_on_sale_app


sql_attr_uint   = sort_order
sql_attr_uint   = img_type_order

sql_attr_float    = overall_rate

sql_attr_uint    = goods_amount
sql_attr_uint    = goods_number
sql_attr_uint    = group_goods_id
sql_attr_uint    = group_color_goods_id
sql_attr_uint    = goods_id1
sql_field_string = goods_sn
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint    = is_new_promote
sql_attr_uint    = is_hot
sql_attr_uint    = img_type
sql_attr_bigint   = promote_start_date
sql_attr_bigint   = promote_end_date
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = day3sale
sql_attr_float    = cxj
sql_attr_float    = week2sale_price
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint   = week1sale_spu
sql_attr_uint   = week2sale_spu
sql_attr_uint   = zhekou
sql_attr_uint    = is_login
sql_attr_uint    = is_new
sql_attr_uint    = is_deals
sql_attr_float   = goods_weight
sql_attr_bigint  = seo_id
sql_attr_uint    = cat_id
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_bigint    = new_goods_weight
#sql_field_string = goods_attr
#sql_attr_string = goods_attr
sql_field_string = goods_url_title
#sql_attr_string = goods_url_title
sql_attr_uint = attention_num
sql_attr_uint    = shelf_down_type
sql_attr_bigint   = first_on_sale_time
sql_attr_bigint   = last_on_sale_time
sql_attr_uint    = is_distribution
sql_attr_uint    = ship_distribution
sql_attr_float    = clearance_discount
sql_attr_float    = recommendation
sql_attr_uint   = recommended_level
sql_field_string = goods_model
sql_attr_float    =promote_price
sql_attr_uint    =shelf_down_type_unsalable
sql_attr_uint    = unsalable
sql_attr_uint    = week1sale
sql_attr_float    = week1sale_price
sql_attr_uint    = has_goods_brand
sql_attr_uint    = is_dressfo_brand
sql_attr_uint    = is_nextmia_brand
sql_attr_uint    = has_goods_ru
sql_attr_uint    = available_stock
sql_attr_uint    = real_time_number
sql_attr_uint    = is_sample_making
sql_attr_uint    = is_bf
sql_attr_uint    = label_level
sql_attr_bigint   = update_time
sql_attr_multi       = uint disabled_country_code from field disabled_country_code
sql_attr_multi       = uint on_sale_country from field on_sale_country
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint label_id_all from query; SELECT goods_id,label_id FROM eload_goods_label
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

source rosegal_com_ru_delta : rosegal_com_ru {
	sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='rosegal_com_ru'
	sql_query = \
	SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale,IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution,IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',gru.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
					   g.week1sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 CONCAT_WS(' ',gru.goods_title,GROUP_CONCAT(gal.attr_value_lang SEPARATOR ' ')) AS goods_lang_title_color_size, \
 REPLACE(gru.goods_search_attr,',','') AS goods_search_attr_test, \
 ((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and ru_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and ru_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,gru.goods_search_attr, \
   gru.goods_title, gru.goods_name,gru.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,ge.goods_brand,(IF(gru.goods_title IS NULL,0,1)) AS has_goods_ru,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                JOIN `eload_goods_ru` AS `gru` ON((`gru`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                LEFT JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'ru' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'ru' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' \
				AND g.update_time > (SELECT FROM_UNIXTIME(last_time) FROM eload_sphinx_counter WHERE index_name='rosegal_com_ru') \
				GROUP BY g.goods_id
	sql_query_post = UPDATE eload_sphinx_counter SET last_time=(SELECT UNIX_TIMESTAMP(MAX(update_time)) FROM eload_goods) WHERE index_name='rosegal_com_ru'
}

index rosegal_ru
{
    source               =  rosegal_com_ru
    path                 = /usr/local/sphinx/var/data/rosegal_com_ru
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,goods_search_attr_test,goods_lang_title_color_size,goods_brand
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}
##############rosegal_ru end

index rosegal_ru_delta : rosegal_ru {
    source                  = rosegal_com_ru_delta
    path                    = /usr/local/sphinx/var/data/rosegal_com_ru_delta
}

##############rosegal_ar
source rosegal_com_ar
{
        type                                    = mysql

        sql_host                                = 10.60.46.193
        sql_user                                = sphinx_user
        sql_pass                                = kwsYU53ukPEAuu
        sql_db                                  = rosegal_db
        #sql_sock                          =  /usr/local/ver04/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale,IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution, IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',gar.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
					   g.week1sale_spu,g.week2sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 REPLACE(gar.goods_search_attr,',','') AS goods_search_attr_test, \
 ((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and ar_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and ar_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,gar.goods_search_attr, \
   gar.goods_title, gar.goods_name,gar.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,ge.goods_brand,(IF(gar.goods_title IS NULL,0,1)) AS has_goods_ar,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                JOIN `eload_goods_ar` AS `gar` ON((`gar`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                LEFT JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'ar' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'ar' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' GROUP BY g.goods_id
sql_attr_timestamp   = add_time
sql_attr_timestamp   = on_sale_time
sql_attr_uint    = is_24h_ship
sql_attr_uint    = is_blacklist_app
sql_attr_uint    = is_on_sale_sites
sql_attr_uint    = is_on_sale_app


sql_attr_uint   = sort_order
sql_attr_uint   = img_type_order

sql_attr_float    = overall_rate

sql_attr_uint    = goods_amount
sql_attr_uint    = goods_number
sql_attr_uint    = group_goods_id
sql_attr_uint    = group_color_goods_id
sql_attr_uint    = goods_id1
sql_field_string = goods_sn
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint    = is_new_promote
sql_attr_uint    = is_hot
sql_attr_uint    = img_type
sql_attr_bigint   = promote_start_date
sql_attr_bigint   = promote_end_date
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = day3sale
sql_attr_float    = cxj
sql_attr_float    = week2sale_price
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint   = week1sale_spu
sql_attr_uint   = week2sale_spu
sql_attr_uint   = zhekou
sql_attr_uint    = is_login
sql_attr_uint    = is_new
sql_attr_uint    = is_deals
sql_attr_float   = goods_weight
sql_attr_bigint  = seo_id
sql_attr_uint    = cat_id
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_bigint    = new_goods_weight
#sql_field_string = goods_attr
#sql_attr_string = goods_attr
sql_field_string = goods_url_title
#sql_attr_string = goods_url_title
sql_attr_uint = attention_num
sql_attr_uint    = shelf_down_type
sql_attr_bigint   = first_on_sale_time
sql_attr_bigint   = last_on_sale_time
sql_attr_uint    = is_distribution
sql_attr_uint    = ship_distribution
sql_attr_float    = clearance_discount
sql_attr_float    = recommendation
sql_attr_uint   = recommended_level
sql_field_string = goods_model
sql_attr_float    =promote_price
sql_attr_uint    =shelf_down_type_unsalable
sql_attr_uint    = unsalable
sql_attr_uint    = week1sale
sql_attr_float    = week1sale_price
sql_attr_uint    = has_goods_brand
sql_attr_uint    = is_dressfo_brand
sql_attr_uint    = is_nextmia_brand
sql_attr_uint    = has_goods_ar
sql_attr_uint    = available_stock
sql_attr_uint    = real_time_number
sql_attr_uint    = is_sample_making
sql_attr_uint    = is_bf
sql_attr_uint    = label_level
sql_attr_bigint   = update_time
sql_attr_multi       = uint disabled_country_code from field disabled_country_code
sql_attr_multi       = uint on_sale_country from field on_sale_country
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint label_id_all from query; SELECT goods_id,label_id FROM eload_goods_label
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

source rosegal_com_ar_delta : rosegal_com_ar {
	sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='rosegal_com_ar'
	sql_query = \
	SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale,IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution, IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',gar.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
					   g.week1sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 REPLACE(gar.goods_search_attr,',','') AS goods_search_attr_test, \
 ((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and ar_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and ar_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,gar.goods_search_attr, \
   gar.goods_title, gar.goods_name,gar.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,ge.goods_brand,(IF(gar.goods_title IS NULL,0,1)) AS has_goods_ar,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                JOIN `eload_goods_ar` AS `gar` ON((`gar`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                LEFT JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'ar' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'ar' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' \
				AND g.update_time > (SELECT FROM_UNIXTIME(last_time) FROM eload_sphinx_counter WHERE index_name='rosegal_com_ar') \
				GROUP BY g.goods_id
	sql_query_post = UPDATE eload_sphinx_counter SET last_time=(SELECT UNIX_TIMESTAMP(MAX(update_time)) FROM eload_goods) WHERE index_name='rosegal_com_ar'
}

index rosegal_ar
{
    source               =  rosegal_com_ar
    path                 = /usr/local/sphinx/var/data/rosegal_com_ar
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,goods_search_attr_test,goods_brand
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+0626,U+0627..U+063A,U+0641..U+064A,U+0679,U+067E,U+0686,U+0688,U+0691,U+0698,U+06AF,U+06BA, U+06BB,U+0660..U+0669->0..9,U+06F0..U+06F9->0..9, U+0622->U+0627, U+0623->U+0627, U+0625->U+0627, U+0671->U+0627, U+0672->U+0627, U+0673->U+0627, U+0675->U+0627, U+066E->U+0628, U+067B->U+0628, U+0680->U+0628, U+06C0->U+0629, U+06C1->U+0629, U+06C2->U+0629, U+06C3->U+0629, U+067A->U+062A, U+067B->U+062A, U+067C->U+062A, U+067D->U+062A, U+067F->U+062A, U+0680->U+062A, U+0681->U+062D, U+0682->U+062D, U+0683->U+062D, U+0684->U+062D, U+0685->U+062D, U+0687->U+0686, U+06BF->U+0686, U+0689->U+062F, U+068A->U+062F, U+068C->U+062F, U+068D->U+062F, U+068E->U+062F, U+068F->U+062F, U+0690->U+062F, U+06EE->U+062F, U+068B->U+0688, U+0692->U+0631, U+0693->U+0631, U+0694->U+0631, U+0695->U+0631, U+0696->U+0631, U+0697->U+0631, U+0699->U+0631, U+06EF->U+0631, U+069A->U+0633, U+069B->U+0633, U+069C->U+0633, U+06FA->U+0633, U+069D->U+0635, U+069E->U+0635, U+06FB->U+0635, U+069F->U+0637, U+06A0->U+0639, U+06FC->U+0639, U+06A1->U+0641, U+06A2->U+0641, U+06A3->U+0641, U+06A4->U+0641, U+06A5->U+0641, U+06A6->U+0641, U+066F->U+0642, U+06A7->U+0642, U+06A8->U+0642, U+063B->U+0643, U+063C->U+0643, U+06A9->U+0643, U+06AA->U+0643, U+06AB->U+0643, U+06AC->U+0643, U+06AD->U+0643, U+06AE->U+0643, U+06B0->U+06AF, U+06B1->U+06AF, U+06B2->U+06AF, U+06B3->U+06AF, U+06B4->U+06AF, U+06B5->U+0644, U+06B6->U+0644, U+06B7->U+0644, U+06B8->U+0644, U+06FE->U+0645, U+06B9->U+0646, U+06BC->U+0646, U+06BD->U+0646, U+06BE->U+0647, U+06C0->U+0647, U+06C1->U+0647, U+06C2->U+0647, U+06C3->U+0647, U+06D5->U+0647, U+06FF->U+0647, U+06C4->U+0648, U+06C5->U+0648, U+06C6->U+0648, U+06C7->U+0648, U+06C8->U+0648, U+06C9->U+0648, U+06CA->U+0648, U+06CB->U+0648, U+06CF->U+0648, U+063D->U+064A, U+063E->U+064A, U+063F->U+064A, U+06CC->U+064A, U+06CD->U+064A, U+06CE->U+064A, U+06D0->U+064A, U+06D1->U+064A, U+06D2->U+064A, U+06D3->U+064A
}
##############rosegal_ar end

index rosegal_ar_delta : rosegal_ar {
    source                  = rosegal_com_ar_delta
    path                    = /usr/local/sphinx/var/data/rosegal_com_ar_delta
}


##############rosegal_es
source rosegal_com_es
{
        type                                    = mysql

        sql_host                                = 10.60.46.193
        sql_user                                = sphinx_user
        sql_pass                                = kwsYU53ukPEAuu
        sql_db                                  = rosegal_db
        #sql_sock                          =  /usr/local/ver04/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale,IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution, IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',ges.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
					   g.week1sale_spu,g.week2sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 CONCAT_WS(' ',ges.goods_title,GROUP_CONCAT(gal.attr_value_lang SEPARATOR ' ')) AS goods_lang_title_color_size, \
 REPLACE(ges.goods_search_attr,',','') AS goods_search_attr_test, \
 ((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and es_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and es_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,ges.goods_search_attr, \
   ges.goods_title, ges.goods_name,ges.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,ge.goods_brand,(IF(ges.goods_title IS NULL,0,1)) AS has_goods_es,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                JOIN `eload_goods_es` AS `ges` ON((`ges`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                LEFT JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'es' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'es' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' GROUP BY g.goods_id
sql_attr_timestamp   = add_time
sql_attr_timestamp   = on_sale_time
sql_attr_uint    = is_24h_ship
sql_attr_uint    = is_blacklist_app
sql_attr_uint    = is_on_sale_sites
sql_attr_uint    = is_on_sale_app


sql_attr_uint   = sort_order
sql_attr_uint   = img_type_order

sql_attr_float    = overall_rate

sql_attr_uint    = goods_amount
sql_attr_uint    = goods_number
sql_attr_uint    = group_goods_id
sql_attr_uint    = group_color_goods_id
sql_attr_uint    = goods_id1
sql_field_string = goods_sn
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint    = is_new_promote
sql_attr_uint    = is_hot
sql_attr_uint    = img_type
sql_attr_bigint   = promote_start_date
sql_attr_bigint   = promote_end_date
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = day3sale
sql_attr_float    = cxj
sql_attr_float    = week2sale_price
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint   = week1sale_spu
sql_attr_uint   = week2sale_spu
sql_attr_uint   = zhekou
sql_attr_uint    = is_login
sql_attr_uint    = is_new
sql_attr_uint    = is_deals
sql_attr_float   = goods_weight
sql_attr_bigint  = seo_id
sql_attr_uint    = cat_id
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_bigint    = new_goods_weight
#sql_field_string = goods_attr
#sql_attr_string = goods_attr
sql_field_string = goods_url_title
#sql_attr_string = goods_url_title
sql_attr_uint = attention_num
sql_attr_uint    = shelf_down_type
sql_attr_bigint   = first_on_sale_time
sql_attr_bigint   = last_on_sale_time
sql_attr_uint    = is_distribution
sql_attr_uint    = ship_distribution
sql_attr_float    = clearance_discount
sql_attr_float    = recommendation
sql_attr_uint   = recommended_level
sql_field_string = goods_model
sql_attr_float    =promote_price
sql_attr_uint    =shelf_down_type_unsalable
sql_attr_uint    = unsalable
sql_attr_uint    = week1sale
sql_attr_float    = week1sale_price
sql_attr_uint    = has_goods_brand
sql_attr_uint    = is_dressfo_brand
sql_attr_uint    = is_nextmia_brand
sql_attr_uint    = has_goods_es
sql_attr_uint    = available_stock
sql_attr_uint    = real_time_number
sql_attr_uint    = is_sample_making
sql_attr_uint    = is_bf
sql_attr_uint    = label_level
sql_attr_bigint   = update_time
sql_attr_multi       = uint disabled_country_code from field disabled_country_code
sql_attr_multi       = uint on_sale_country from field on_sale_country
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint label_id_all from query; SELECT goods_id,label_id FROM eload_goods_label
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

source rosegal_com_es_delta : rosegal_com_es {
	sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='rosegal_com_es'
	sql_query = \
	SELECT g.goods_id,g.goods_id AS goods_id1 ,is_24h_ship,g.goods_sn, g.goods_brief, g.add_time, g.on_sale_time, g.sort_order, g.group_goods_id,g.group_color_goods_id, g.point_rate,g.seo_id, g.goods_weight, g.url_title AS goods_url_title, g.attention_num,ge.recommended_level, \
IF(g.is_best=0,g.promote_start_date,1) AS promote_start_date, IF(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date, \
g.is_new_promote, g.is_free_shipping, g.is_hot,g.is_new,g.is_deals, g.is_promote,\
IFNULL(gs.day3sale, 0) as day3sale, \
IFNULL(gs.week2sale, 0) as week2sale,IFNULL(gs.week2sale_price, 0) as week2sale_price,\
IFNULL(gs.week1sale, 0) as week1sale,IFNULL(gs.week1sale_price, 0) as week1sale_price, \
g.click_count, IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price, g.is_login, g.cat_id, ge.img_type,ge.goods_model, g.goods_number AS goods_amount,(IF(goods_number=0,0,1)) AS goods_number, g.promote_price,(IF(ge.img_type=2, 1,IF(ge.img_type = 1, 2, 3))) AS img_type_order,\
                       ge.review_count AS reviews, ge.shelf_down_type,ge.first_on_sale_time,ge.last_on_sale_time,ge.is_distribution, IF(g.is_sample_making=1 OR is_24h_ship=1,1,0) as ship_distribution,ge.clearance_discount,g.recommendation,CONCAT_WS(' ',ges.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value SEPARATOR ', ,'),',')) AS goods_attr, \
					   g.week1sale_spu, CEIL((market_price - (IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), g.promote_price, g.shop_price)))*100/market_price) AS zhekou, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value SEPARATOR ' ')) AS goods_title_color_size, \
 CONCAT_WS(' ',ges.goods_title,GROUP_CONCAT(gal.attr_value_lang SEPARATOR ' ')) AS goods_lang_title_color_size, \
 REPLACE(ges.goods_search_attr,',','') AS goods_search_attr_test, \
 ((IFNULL(gs.week2sale, 0)+1)*LN((IF (IFNULL(ge.available_stock, 0) <= 0, 0, ge.available_stock ))+1)) AS cxj,g.is_blacklist_app, is_on_sale,if(is_on_sale_sites = 1 and es_show = 1,1,0) as is_on_sale_sites,if(is_on_sale_app = 1 and es_show = 1,1,0) as is_on_sale_app,\
(IF(ge.shelf_down_type=100,1,IF(ge.unsalable>0,1,0))) AS shelf_down_type_unsalable, ge.unsalable, \
 CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,(ca.new_sort_order + UNIX_TIMESTAMP(FROM_UNIXTIME(g.add_time,'%Y-%m-%d'))*100) AS new_goods_weight,ges.goods_search_attr, \
   ges.goods_title, ges.goods_name,ges.update_time,(IF(ge.goods_brand='',0,1)) AS has_goods_brand,(IF(ge.goods_brand LIKE 'DRESSFO%',1,0)) AS is_dressfo_brand,(IF(ge.goods_brand LIKE 'nextmia%',1,0)) AS is_nextmia_brand,ge.goods_brand,(IF(ges.goods_title IS NULL,0,1)) AS has_goods_es,rrc.overall_rate,g.disabled_country_code,ge.available_stock,g.is_sample_making, \
   ge.real_time_number,IF(ge.sale_country='',0,ge.sale_country) AS on_sale_country,ge.is_bf \
   ,if(FIND_IN_SET('598',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('608',GROUP_CONCAT(gl.label_id)) or FIND_IN_SET('612',GROUP_CONCAT(gl.label_id)) ,1,0)  as label_level \
                FROM eload_goods AS g \
                JOIN `eload_goods_es` AS `ges` ON((`ges`.`goods_id` = `g`.`goods_id`)) \
                LEFT JOIN eload_category AS ca ON g.cat_id=ca.cat_id \
                LEFT JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr AS ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_r_rosegal_category AS rrc ON g.goods_sn = rrc.goods_sn\
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'es' \
				LEFT JOIN eload_goods_sale as gs on g.goods_id = gs.goods_id AND gs.lang = 'es' \
				LEFT JOIN eload_goods_label as gl on g.goods_id = gl.goods_id \
                WHERE g.is_on_sale=1 AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' \
				AND g.update_time > (SELECT FROM_UNIXTIME(last_time) FROM eload_sphinx_counter WHERE index_name='rosegal_com_es') \
				GROUP BY g.goods_id
	sql_query_post = UPDATE eload_sphinx_counter SET last_time=(SELECT UNIX_TIMESTAMP(MAX(update_time)) FROM eload_goods) WHERE index_name='rosegal_com_es'
}

index rosegal_es
{
    source               =  rosegal_com_es
    path                 = /usr/local/sphinx/var/data/rosegal_com_es
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,goods_search_attr_test,goods_lang_title_color_size,goods_brand
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}
##############rosegal_es end

index rosegal_es_delta : rosegal_es {
    source                  = rosegal_com_es_delta
    path                    = /usr/local/sphinx/var/data/rosegal_com_es_delta
}

source rosegal_keywords {
    type                    = mysql
    sql_host                = 10.60.46.193
    sql_user                = sphinx_user
    sql_pass                = kwsYU53ukPEAuu
    sql_db                  = rosegal_db

    sql_query_pre           = SET NAMES utf8
    sql_query_pre           = REPLACE INTO eload_sphinx_counter SELECT 'rosegal_keywords',MAX(last_update_time),UNIX_TIMESTAMP() FROM eload_abc_index_keywords
    sql_query               = \
                            SELECT keyword_id,keyword_id AS keyword_id1,SUBSTRING(keyword,1,1) AS first_letter,keyword,cat_id,top_cat_id,goods_num,IF(word_count>5, 5, word_count) AS word_count,0 AS is_delete ,lang,is_show,is_new \
                            FROM eload_abc_index_keywords
    sql_query_info          = SELECT * FROM eload_abc_index_keywords WHERE keyword_id=$id
    #sql_query_post_index    = CALL sphinx_sql_query_post_index('rosegal_keywords', 'rosegal_keywords')
    sql_attr_uint           = keyword_id1
    sql_attr_uint           = cat_id
    sql_attr_uint           = top_cat_id
    sql_attr_uint           = word_count
    sql_attr_uint           = is_delete
    #sql_attr_string        = keyword
    sql_field_string 	    = keyword
    sql_attr_uint           = goods_num
	sql_attr_uint 	    	= lang
    sql_attr_uint           = is_show
	sql_attr_uint 	    	= is_new
}
source rosegal_keywords_delta : rosegal_keywords {
    sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='rosegal_keywords'
    #sql_query_post_index    = CALL sphinx_sql_query_post_index('sammydress_keywords', 'sammydress_keywords_delta')
    sql_query               = \
                            SELECT keyword_id,keyword_id AS keyword_id1,SUBSTRING(keyword,1,1) AS first_letter,keyword,cat_id,top_cat_id,goods_num,IF(word_count>5, 5, word_count) AS word_count,0 AS is_delete,lang\
                            FROM eload_abc_index_keywords\
                            WHERE last_update_time>(SELECT last_time FROM eload_sphinx_counter WHERE index_name='rosegal_keywords')
}

index rosegal_keywords {
    source                  = rosegal_keywords
    path                    = /usr/local/sphinx/var/data/rosegal_keywords
    charset_table           = 0..9, A..Z->a..z, _, a..z, .
    charset_type            = utf-8

}

index rosegal_keywords_delta : rosegal_keywords {
    source                  = rosegal_keywords_delta
    path                    = /usr/local/sphinx/var/data/rosegal_keywords_delta
}


source rosegal_hot_keywords
{
        type                                    = mysql
        sql_host                                = 10.60.46.193
        sql_user                                = sphinx_user
        sql_pass                                = kwsYU53ukPEAuu 
        sql_db                                  = rosegal_db
        sql_sock                         		=  /tmp/mysql.sock
        sql_port                                = 3306  
		sql_query_pre 							= SET NAMES utf8
        #30(3)
		sql_query                               = \
		SELECT ak.keyword_id,ak.keyword,SUM(k.count) AS three_count FROM  `eload_keywords` AS k INNER JOIN `eload_abc_index_keywords` AS ak  ON ak.`keyword`=k.`keyword` WHERE k.`searchengine`='rosegal.com' AND k.date>=FROM_UNIXTIME(UNIX_TIMESTAMP()-24*3600*30,'%Y-%m-%d') GROUP BY k.`keyword` ORDER BY three_count DESC LIMIT 20000
		sql_attr_uint    = three_count
		sql_field_string   = keyword

}


index rosegal_hot_keywords {
    source                  = rosegal_hot_keywords
    path                    = /usr/local/sphinx/var/data/rosegal_hot_keywords
    charset_table           = 0..9, A..Z->a..z, _, a..z, .
    charset_type            = utf-8
	docinfo         		= extern
	enable_star         	= 1
	min_infix_len			= 1
	infix_fields			= keyword
	
}


##############rosegal_recommend_keyword
source rosegal_recommend_keyword
{
        type                                    = mysql
 
        sql_host                                = 10.60.46.193
        sql_user                                = sphinx_user
        sql_pass                                = kwsYU53ukPEAuu 
        sql_db                                  = rosegal_db
        sql_sock                         		=  /tmp/mysql.sock
        sql_port                                = 3306  
		sql_query_pre 							= SET NAMES utf8
        
		sql_query                               = \
		select id,keyword,cat_id,lang,url,goods_number,`level`,uptime from `eload_recommend_keyword` where is_show = 1 GROUP BY keyword
		sql_attr_uint      = lang
		sql_attr_uint      = cat_id
		sql_attr_uint      = goods_number
		sql_attr_uint      = level
		sql_attr_timestamp = uptime
		sql_field_string   = keyword
		sql_field_string   = url

}

index rosegal_recommend_keyword {
    source                  = rosegal_recommend_keyword
		
	path                    = /usr/local/sphinx/var/data/rosegal_recommend_keyword
    charset_table           = 0..9, A..Z->a..z, _, a..z, .
    charset_type            = utf-8
	docinfo         		= extern
	enable_star         	= 1
	min_infix_len			= 1
	infix_fields			= keyword
	
}
##############rosegal_recommend_keyword end

##############rosegal_integral_goods
source rosegal_integral_goods
{
        type                                    = mysql
 
        sql_host                                = 10.60.46.193
        sql_user                                = sphinx_user
        sql_pass                                = kwsYU53ukPEAuu 
        sql_db                                  = rosegal_db
        sql_sock                         		=  /tmp/mysql.sock
        sql_port                                = 3306  
		sql_query_pre 							= SET NAMES utf8
        
		sql_query                               = \
		    SELECT g.goods_id,g.goods_id AS goods_id_bak,gas.id,g.goods_number as goods_amount,(if(goods_number=0,0,1)) as goods_number,g.week2sale,g.is_blacklist_app,g.disabled_country_code,ge.shelf_down_type,ge.is_24h_ship,g.is_free_shipping,ge.mobile_exclusive,CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP() AND g.is_new_promote=0, 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order ,g.sort_order,if(g.is_best=0,g.promote_start_date,1) AS promote_start_date, if(g.is_best=0,g.promote_end_date,9999999999) AS promote_end_date,g.promote_price,IF (g.promote_start_date < UNIX_TIMESTAMP() AND g.promote_end_date > UNIX_TIMESTAMP() and g.promote_price <> '0.00',g.promote_price,g.shop_price) as shop_price,g.recommendation,g.goods_sn,g.cat_id,g.group_goods_id,g.group_color_goods_id,g.week2sale_price,g.click_count,g.attention_num,g.add_time,gas.is_set_time,if (gas.is_set_time=0,0,sale_start_time) as sale_start_time,\
			if (gas.is_set_time=0,88888888888,sale_end_time) as sale_end_time,gas.is_pc,gas.is_wap,gas.cheap_money, \
			gas.insert_time,\
			g.is_on_sale_sites,g.is_on_sale_app,g.en_show,g.fr_show,g.ru_show,g.ar_show,g.es_show,ge.is_bf \
			FROM eload_goods_app_sale AS gas LEFT JOIN eload_goods AS g ON g.goods_sn = gas.goods_sn LEFT JOIN eload_goods_extend AS ge ON g.goods_id = ge.goods_id \
			WHERE gas.STATUS = 1 AND g.is_on_sale = 1 AND g.is_on_sale_sites = 1 AND g.is_delete = 0 group by gas.goods_sn
		sql_attr_uint      = goods_id_bak
		sql_attr_uint      = goods_amount
		sql_attr_uint      = goods_number
		sql_attr_uint      = week2sale
		sql_attr_uint      = hot_order
		sql_attr_uint      = sort_order
		sql_attr_float      = shop_price
		sql_attr_float      = recommendation
		sql_attr_uint    = is_blacklist_app
		sql_attr_uint    = is_on_sale_app
		sql_attr_uint    = is_on_sale_sites
		sql_attr_uint    = en_show
		sql_attr_uint    = fr_show
		sql_attr_uint    = ru_show
		sql_attr_uint    = ar_show
		sql_attr_uint    = es_show
		sql_attr_uint    = shelf_down_type
		sql_attr_uint    = is_24h_ship
		sql_attr_uint    = is_free_shipping
		sql_attr_float    = mobile_exclusive
		sql_attr_bigint   = promote_start_date
		sql_attr_bigint   = promote_end_date
		sql_attr_float    = promote_price
		sql_attr_uint      = insert_time
		sql_attr_uint      = is_set_time
		sql_attr_uint      = sale_start_time
		sql_attr_uint      = sale_end_time
		sql_attr_uint    = is_pc
		sql_attr_uint    = is_bf
		sql_attr_uint   = is_wap
		sql_attr_uint   = cat_id
		sql_attr_float = cheap_money
		sql_attr_uint = group_goods_id
		sql_attr_uint = group_color_goods_id
		sql_attr_uint = add_time
		sql_attr_float = week2sale_price
		sql_attr_uint = click_count
		sql_attr_uint = attention_num
		sql_field_string = goods_sn
		sql_attr_multi       = uint disabled_country_code from field disabled_country_code
		sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
}

index rosegal_integral_goods {
    source                  = rosegal_integral_goods
		
	path                    = /usr/local/sphinx/var/data/rosegal_integral_goods
    charset_table           = 0..9, A..Z->a..z, _, a..z, .
    charset_type            = utf-8
	docinfo         		= extern
	enable_star         	= 1
	min_infix_len			= 1
	infix_fields			= goods_id
	
}
##############rosegal_integral_goods end


indexer
{
        mem_limit = 512M
}


searchd
{
        port                    = 9320
        #listen                 = 9306:mysql41
        log                     = /usr/local/sphinx/var/log/rosegal.searchd.log
        query_log               = /usr/local/sphinx/var/log/rosegal.query.log
        read_timeout            = 5
        max_children            = 30
        pid_file                = /usr/local/sphinx/var/log/rosegal.searchd.pid
        max_matches             = 10000
        seamless_rotate         = 1
        preopen_indexes         = 1
        unlink_old              = 1
        compat_sphinxql_magics  = 0
        workers                 = threads # for RT to work
        binlog_path             = /usr/local/sphinx/var/data
}




