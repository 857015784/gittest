source ahappydeal
{
        type                                    = mysql

        sql_host                                = 192.168.6.71
        sql_user                                = dlm_m_user
        sql_pass                                = tc6CrEuvbtGqo
        sql_db                                  = dm_db
	#sql_sock                          =  /usr/local/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
	sql_query_pre = SET NAMES utf8
        sql_query                               = select * from view_sphinx_goods
	sql_attr_timestamp   = add_time
        sql_attr_timestamp   = sale_time
        sql_attr_uint   = sale_date
	sql_attr_uint   = is_24h_ship
	sql_attr_uint   = goods_id_attr
	sql_attr_uint   = add_date
	sql_attr_uint   = group_goods_id
	sql_attr_uint   = sale_number_attr
	sql_attr_uint   = shop_price_attr
	sql_attr_uint   = goods_number
	sql_attr_uint   = is_delete
	sql_attr_uint   = gifts_id
	sql_attr_uint   = cat_id
	sql_attr_uint   = goods_thumb
	sql_attr_float  = shop_price
	sql_attr_float  = conversion_rate
	sql_attr_uint    = is_on_sale
	sql_attr_uint    = is_free_shipping
	sql_attr_uint    = is_login
	sql_attr_uint    = sale_number
	sql_attr_uint    = week2sale
	sql_attr_uint    = newordervalue
	sql_attr_uint    = is_best
	sql_attr_uint    = is_new
	sql_attr_uint    = is_hot
	sql_attr_uint    = is_alone_sale
        sql_attr_timestamp    = promote_start_date
	sql_attr_timestamp    = promote_end_date
	#sql_attr_uint    = is_home
	#sql_attr_uint    = click_count
	sql_attr_uint    = reviews
	#sql_attr_float   = conversion_rate
	sql_attr_float   = conversion_rate2
	sql_field_string = goods_title
	sql_attr_string  = url_title
	sql_attr_string  = goods_img
        sql_attr_float        = promote_price
        sql_attr_float          = market_price
	sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t

}


index ahappydeal
{
    source               =  ahappydeal
    path                 = /usr/local/sphinx/var/data/ahappydeal
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,keywords
    min_infix_len        = 1
charset_table           = 0..9,A..Z->a..z,a..z,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E
}

source ahappydeal_ru
{
        type                                    = mysql
        sql_host                                = 192.168.6.71
        sql_user                                = dlm_m_user
        sql_pass                                = tc6CrEuvbtGqo
        sql_db                                  = dm_db
        sql_port                                = 3306  # optional, default is 3306
        sql_query_pre                           = SET NAMES utf8
        sql_query                               = select * from view_sphinx_goods_ru
        sql_attr_timestamp   = add_time
        sql_attr_uint   = is_24h_ship
        sql_attr_uint   = goods_id_attr
        sql_attr_uint   = add_date
        sql_attr_uint   = group_goods_id
        sql_attr_uint   = sale_number_attr
        sql_attr_uint   = shop_price_attr
        sql_attr_uint   = goods_number
        sql_attr_uint   = is_delete
        sql_attr_uint   = cat_id
        sql_attr_uint   = goods_thumb
        sql_attr_float  = shop_price
        sql_attr_float  = conversion_rate
        sql_attr_uint    = is_on_sale
        sql_attr_uint    = is_free_shipping
        sql_attr_uint    = is_login
        sql_attr_uint    = sale_number
        sql_attr_uint    = week2sale
        sql_attr_uint    = newordervalue
        sql_attr_uint    = is_best
        sql_attr_uint    = is_new
        sql_attr_uint    = is_hot
        sql_attr_uint    = is_alone_sale
        #sql_attr_uint    = is_home
        #sql_attr_uint    = click_count
        sql_attr_uint    = reviews
        #sql_attr_float   = conversion_rate
        sql_attr_float   = conversion_rate2
        sql_attr_multi   = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
}


source ahappydeal_fr
{
        type                                    = mysql
        sql_host                                = 192.168.6.71
        sql_user                                = dlm_m_user
        sql_pass                                = tc6CrEuvbtGqo
        sql_db                                  = dm_db
        sql_port                                = 3306  # optional, default is 3306
        sql_query_pre                           = SET NAMES utf8
        sql_query                               = select * from view_sphinx_goods_fr
        sql_attr_timestamp   = add_time
        sql_attr_uint   = is_24h_ship
        sql_attr_uint   = goods_id_attr
        sql_attr_uint   = add_date
        sql_attr_uint   = group_goods_id
        sql_attr_uint   = sale_number_attr
        sql_attr_uint   = shop_price_attr
        sql_attr_uint   = goods_number
        sql_attr_uint   = is_delete
        sql_attr_uint   = cat_id
        sql_attr_uint   = goods_thumb
        sql_attr_float  = shop_price
        sql_attr_float  = conversion_rate
        sql_attr_uint    = is_on_sale
        sql_attr_uint    = is_free_shipping
        sql_attr_uint    = is_login
        sql_attr_uint    = sale_number
        sql_attr_uint    = week2sale
        sql_attr_uint    = newordervalue
        sql_attr_uint    = is_best
        sql_attr_uint    = is_new
        sql_attr_uint    = is_hot
        sql_attr_uint    = is_alone_sale
        #sql_attr_uint    = is_home
        #sql_attr_uint    = click_count
        sql_attr_uint    = reviews
        #sql_attr_float   = conversion_rate
        sql_attr_float   = conversion_rate2
        sql_attr_multi   = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
}

source ahappydeal_es
{
        type                                    = mysql
        sql_host                                = 192.168.6.71
        sql_user                                = dlm_m_user
        sql_pass                                = tc6CrEuvbtGqo
        sql_db                                  = dm_db
        sql_port                                = 3306  # optional, default is 3306
        sql_query_pre                           = SET NAMES utf8
        sql_query                               = select * from view_sphinx_goods_es
        sql_attr_timestamp   = add_time
        sql_attr_uint   = is_24h_ship
        sql_attr_uint   = goods_id_attr
        sql_attr_uint   = add_date
        sql_attr_uint   = group_goods_id
        sql_attr_uint   = sale_number_attr
        sql_attr_uint   = shop_price_attr
        sql_attr_uint   = goods_number
        sql_attr_uint   = is_delete
        sql_attr_uint   = cat_id
        sql_attr_uint   = goods_thumb
        sql_attr_float  = shop_price
        sql_attr_float  = conversion_rate
        sql_attr_uint    = is_on_sale
        sql_attr_uint    = is_free_shipping
        sql_attr_uint    = is_login
        sql_attr_uint    = sale_number
        sql_attr_uint    = week2sale
        sql_attr_uint    = newordervalue
        sql_attr_uint    = is_best
        sql_attr_uint    = is_new
        sql_attr_uint    = is_hot
        sql_attr_uint    = is_alone_sale
        #sql_attr_uint    = is_home
        #sql_attr_uint    = click_count
        sql_attr_uint    = reviews
        #sql_attr_float   = conversion_rate
        sql_attr_float   = conversion_rate2
        sql_attr_multi   = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
}

source ahappydeal_de
{
        type                                    = mysql
        sql_host                                = 192.168.6.71
        sql_user                                = dlm_m_user
        sql_pass                                = tc6CrEuvbtGqo
        sql_db                                  = dm_db
        sql_port                                = 3306  # optional, default is 3306
        sql_query_pre                           = SET NAMES utf8
        sql_query                               = select * from view_sphinx_goods_de
        sql_attr_timestamp   = add_time
        sql_attr_uint   = is_24h_ship
        sql_attr_uint   = goods_id_attr
        sql_attr_uint   = add_date
        sql_attr_uint   = group_goods_id
        sql_attr_uint   = sale_number_attr
        sql_attr_uint   = shop_price_attr
        sql_attr_uint   = goods_number
        sql_attr_uint   = is_delete
        sql_attr_uint   = cat_id
        sql_attr_uint   = goods_thumb
        sql_attr_float  = shop_price
        sql_attr_float  = conversion_rate
        sql_attr_uint    = is_on_sale
        sql_attr_uint    = is_free_shipping
        sql_attr_uint    = is_login
        sql_attr_uint    = sale_number
        sql_attr_uint    = week2sale
        sql_attr_uint    = newordervalue
        sql_attr_uint    = is_best
        sql_attr_uint    = is_new
        sql_attr_uint    = is_hot
        sql_attr_uint    = is_alone_sale
        #sql_attr_uint    = is_home
        #sql_attr_uint    = click_count
        sql_attr_uint    = reviews
        #sql_attr_float   = conversion_rate
        sql_attr_float   = conversion_rate2
        sql_attr_multi   = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
}

source ahappydeal_pt
{
        type                                    = mysql
        sql_host                                = 192.168.6.71
        sql_user                                = dlm_m_user
        sql_pass                                = tc6CrEuvbtGqo
        sql_db                                  = dm_db
        sql_port                                = 3306  # optional, default is 3306
        sql_query_pre                           = SET NAMES utf8
        sql_query                               = select * from view_sphinx_goods_pt
        sql_attr_timestamp   = add_time
        sql_attr_uint   = is_24h_ship
        sql_attr_uint   = goods_id_attr
        sql_attr_uint   = add_date
        sql_attr_uint   = group_goods_id
        sql_attr_uint   = sale_number_attr
        sql_attr_uint   = shop_price_attr
        sql_attr_uint   = goods_number
        sql_attr_uint   = is_delete
        sql_attr_uint   = cat_id
        sql_attr_uint   = goods_thumb
        sql_attr_float  = shop_price
        sql_attr_float  = conversion_rate
        sql_attr_uint    = is_on_sale
        sql_attr_uint    = is_free_shipping
        sql_attr_uint    = is_login
        sql_attr_uint    = sale_number
        sql_attr_uint    = week2sale
        sql_attr_uint    = newordervalue
        sql_attr_uint    = is_best
        sql_attr_uint    = is_new
        sql_attr_uint    = is_hot
        sql_attr_uint    = is_alone_sale
        #sql_attr_uint    = is_home
        #sql_attr_uint    = click_count
        sql_attr_uint    = reviews
        #sql_attr_float   = conversion_rate
        sql_attr_float   = conversion_rate2
        sql_attr_multi   = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
}

index ahappydeal_es
{
    source               =  ahappydeal_es
    path                 = /usr/local/sphinx/var/data/ahappydeal_es
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,keywords
    min_infix_len        = 1
charset_table           = 0..9,A..Z->a..z,a..z,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E
}


index ahappydeal_ru
{
    source               =  ahappydeal_ru
    path                 = /usr/local/sphinx/var/data/ahappydeal_ru
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,keywords
    min_infix_len        = 1
charset_table           = 0..9,A..Z->a..z,a..z,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E
}

index ahappydeal_fr
{
    source               =  ahappydeal_fr
    path                 = /usr/local/sphinx/var/data/ahappydeal_fr
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,keywords
    min_infix_len        = 1
charset_table           = 0..9,A..Z->a..z,a..z,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E
}

index ahappydeal_de
{
    source               =  ahappydeal_de
    path                 = /usr/local/sphinx/var/data/ahappydeal_de
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,keywords
    min_infix_len        = 1
charset_table           = 0..9,A..Z->a..z,a..z,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E
}

index ahappydeal_pt
{
    source               =  ahappydeal_pt
    path                 = /usr/local/sphinx/var/data/ahappydeal_pt
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,keywords
    min_infix_len        = 1
charset_table           = 0..9,A..Z->a..z,a..z,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E
}

source ahappydeal_keywords {
    type                    = mysql
    sql_host                = 192.168.6.71
    sql_user                = dlm_m_user
    sql_pass                = tc6CrEuvbtGqo
    sql_db                  = dm_db

    sql_query_pre           = SET NAMES utf8
    #sql_query_pre           = REPLACE INTO eload_sphinx_counter SELECT 'ahappydeal_keywords',MAX(last_update_time),UNIX_TIMESTAMP() FROM eload_abc_index_keywords_new2
    sql_query               = SELECT * FROM eload_abc_index_keywords_new2
    #sql_query_info          = SELECT * FROM eload_abc_index_keywords_new2 WHERE keyword_id=$id
    #sql_query_post_index    = CALL sphinx_sql_query_post_index('ahappydeal_keywords', 'ahappydeal_keywords')

    sql_attr_uint           = cat_id
    sql_attr_uint           = top_cat_id
    sql_attr_uint           = word_count
    sql_field_string         = keyword
    sql_attr_uint           = goods_num
}

source ahappydeal_keywords_delta : ahappydeal_keywords {
    sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='everbuying_keywords'
    sql_query_post_index    = CALL sphinx_sql_query_post_index('ahappydeal_keywords', 'ahappydeal_keywords_delta')
    sql_query               = \
                            SELECT keyword_id,SUBSTRING(keyword,1,1) AS first_letter,keyword,cat_id,top_cat_id,goods_num,IF(word_count>5, 5, word_count) AS word_count,0 AS is_delete\
                            FROM eload_abc_index_keywords_new2\
                            WHERE last_update_time>(SELECT last_time FROM eload_sphinx_counter WHERE index_name='ahappydeal_keywords')
}

index ahappydeal_keywords {
    source                  = ahappydeal_keywords
    path                    = /usr/local/sphinx/var/data/ahappydeal_keywords
    charset_table           = 0..9, A..Z->a..z, _, a..z, .
    charset_type            = utf-8

}

index ahappydeal_keywords_delta : ahappydeal_keywords {
    source                  = ahappydeal_keywords_delta
    path                    = /usr/local/sphinx/var/data/ahappydeal_keywords_delta
}


indexer {
        mem_limit           = 512M
}


searchd {
    listen                  = 9314
    log                     = /usr/local/sphinx/var/log/ahappdeal.log
    query_log               = /usr/local/sphinx/var/log/ahappydeal_query.log
    pid_file                = /usr/local/sphinx/var/log/ahappydeal_searchd.pid
    read_timeout            = 5
    max_children            = 30
    max_matches             = 2500
    seamless_rotate         = 1
    preopen_indexes         = 0
    unlink_old              = 1
    binlog_path             =
    compat_sphinxql_magics  = 0
}

#/usr/local/ver01/sphinx208/bin/indexer --config /usr/local/ver01/sphinx208/etc/ahappydeal.conf --all --rotate
#/usr/local/ver01/sphinx208/bin/searchd --config /usr/local/ver01/sphinx208/etc/ahappydeal.conf
#/usr/local/ver01/sphinx208/bin/indexer indexer --merge ahappydeal_keywords ahappydeal_keywords_delta --merge-dst-range is_delete 0 0 --config /usr/local/ver01/sphinx208/etc/ahappydeal.conf --rotate
