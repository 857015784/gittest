#
# Minimal Sphinx configuration sample (clean, simple, functional)
#
# uk index
source os_gearbest_uk
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
es.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, es.goods_title, es.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, (if(sum(og.stock_amount) > 0,1,0)) as stock_amount,gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
 ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
				FROM eload_goods as g \
				INNER JOIN eload_goods_uk as es on g.goods_id = es.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'uk' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
				INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
				LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='uk')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint	 = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi		 = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0

}

# uk index
index os_gearbest_uk
{
    source               =  os_gearbest_uk
    path                 = /data/sphinx/var/data/os_gearbest_uk
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}
# 配置测试海外仓迁移结束uk

# us index
source os_gearbest_us
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
es.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, es.goods_title, es.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, (if(sum(og.stock_amount) > 0,1,0)) as stock_amount,gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
 ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
				FROM eload_goods as g \
				INNER JOIN eload_goods_us as es on g.goods_id = es.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'us' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
				INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
                LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
				WHERE g.is_alone_sale = 1  AND   FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='us')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint	 = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi		 = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

# uk index
index os_gearbest_us
{
    source               =  os_gearbest_us
    path                 = /data/sphinx/var/data/os_gearbest_us
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}
# 配置测试海外仓迁移结束us


# de index
source os_gearbest_de
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
es.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, es.goods_title, es.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, (if(sum(og.stock_amount) > 0,1,0)) as stock_amount,gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
 ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
				FROM eload_goods as g \
                INNER JOIN eload_goods_de as es on g.goods_id = es.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'de' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
                INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
				LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND   FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='de')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint  = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi       = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

# de index
index os_gearbest_de
{
    source               =  os_gearbest_de
    path                 = /data/sphinx/var/data/os_gearbest_de
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}
# 配置测试海外仓迁移结束de

# pt index
source os_gearbest_pt
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
es.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, es.goods_title, es.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, (if(sum(og.stock_amount) > 0,1,0)) as stock_amount,gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
 ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
				FROM eload_goods as g \
                INNER JOIN eload_goods_pt as es on g.goods_id = es.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'pt' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
                INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
				LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND   FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='pt')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint  = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi       = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

# pt index
index os_gearbest_pt
{
    source               =  os_gearbest_pt
    path                 = /data/sphinx/var/data/os_gearbest_pt
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}
# 配置测试海外仓迁移结束pt

# 配置测试海外仓迁移
source os_gearbest
{
        type                                    = mysql
        sql_host                                = 127.0.0.1
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=3 and ge.yesterday_sale>=4 then 1 \
when og.shop_price > 3 and og.shop_price<=7 and ge.yesterday_sale>=3 then 1 \
when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=2 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=2 then 1 else 0 end as is_show_trending, \
ge.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, g.goods_title, g.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
(if(sum(og.stock_amount) > 0,1,0)) as stock_amount, ge.recommended_time,if((og.is_on_sale and og.sale_mark = 3),100,0) as shelf_down_type, ge.clearance_discount,og.goods_number as goods_number1,og.wid as owid,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(ga.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
				FROM eload_goods as g \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
				INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
				LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND g.is_delete = 0 AND FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='en'))  GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = goods_number1
sql_attr_uint    = owid
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
#sql_attr_uint	 = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    =is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi		 = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0

}

index os_gearbest
{
    source               =  os_gearbest
    path                 = /data/sphinx/var/data/os_gearbest
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+3E,U+3C
}

# ru index
source os_gearbest_ru
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
ru.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, ru.goods_title, ru.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
(if(sum(og.stock_amount) > 0,1,0)) as stock_amount, ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
				FROM eload_goods as g \
				INNER JOIN eload_goods_ru as ru on g.goods_id = ru.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'ru' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
				INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
				LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND  FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='ru')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint	 = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id = g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi		 = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

# ru index
index os_gearbest_ru
{
    source               =  os_gearbest_ru
    path                 = /data/sphinx/var/data/os_gearbest_ru
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}

# es index
source os_gearbest_es
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
es.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, es.goods_title, es.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, g.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
(if(sum(og.stock_amount) > 0,1,0)) as stock_amount, ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
				FROM eload_goods as g \
				INNER JOIN eload_goods_es as es on g.goods_id = es.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
				LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'es' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
				INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
				LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND  FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='es'))  GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint	 = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi		 = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

# es index
index os_gearbest_es
{
    source               =  os_gearbest_es
    path                 = /data/sphinx/var/data/os_gearbest_es
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}

# 配置测试海外仓迁移结束

# it index
source os_gearbest_it
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
it.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, it.goods_title, it.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, (if(sum(og.stock_amount) > 0,1,0)) as stock_amount,gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
 ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
				FROM eload_goods as g \
                INNER JOIN eload_goods_it as it on g.goods_id = it.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'it' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
                INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
				LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND  FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='it')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint  = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi       = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0
}

# it index
index os_gearbest_it
{
    source               =  os_gearbest_it
    path                 = /data/sphinx/var/data/os_gearbest_it
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}

# 配置测试海外仓迁移结束

# 配置知识库开始
source gearbest_blog
{
        type          = mysql
        sql_host      = 127.0.0.1
        sql_user      = sphinx_user
        sql_pass      = 123456
        sql_db        = gearbest_db
        sql_sock     = /usr/local/ver01/percona/tmp/mysql.sock
        sql_port      = 3306  # optional, default is 3306
        sql_query_pre = SET NAMES utf8
        sql_query     = \
						SELECT id, title, description, add_date, url_title, list_img_url, article_type, front_end_user,\
							visited_count, virtual_visited_count, is_display, pre_post_time,\
							CASE true WHEN is_display = 1 AND pre_post_time = 0 THEN 1 \
								WHEN is_display = 1 AND pre_post_time > NOW() THEN 1 ELSE 0 END AS art_is_display, \
							(visited_count + virtual_visited_count) AS v_count \
						FROM eload_blog_article

		sql_attr_timestamp   = add_date
		sql_attr_timestamp   = pre_post_time
		sql_attr_uint        = article_type
		sql_attr_uint        = visited_count
		sql_attr_uint        = virtual_visited_count
		sql_attr_uint        = v_count
		sql_attr_uint        = is_display
		sql_attr_uint        = art_is_display
		sql_field_string     = description
		sql_field_string     = title
		sql_field_string     = url_title
		sql_field_string     = list_img_url
		sql_field_string     = front_end_user
}

index gearbest_blog
{
    source               =  gearbest_blog
    path                 = /data/sphinx/var/data/gearbest_blog
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = title
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+3E,U+3C
}

# 配置知识库结束

source gearbest_keywords {
    type                    = mysql
    sql_host                = 127.0.0.1
    sql_user                = sphinx_user
    sql_pass                = 123456
    sql_db                  = gearbest_db
    sql_sock                =  /usr/local/ver01/percona/tmp/mysql.sock
    sql_port                = 3306  # optional, default is 3306

    sql_query_pre           = SET NAMES utf8
    sql_query_pre           = REPLACE INTO eload_sphinx_counter SELECT 'sammydress_keywords',MAX(last_update_time),UNIX_TIMESTAMP() FROM eload_abc_index_keywords
    sql_query               = \
                            SELECT keyword_id,SUBSTRING(keyword,1,1) AS first_letter,keyword,lang,cat_id,top_cat_id,goods_num,IF(word_count>5, 5, word_count) AS word_count,0 AS is_delete \
                            FROM eload_abc_index_keywords
    sql_query_info          = SELECT * FROM eload_abc_index_keywords WHERE keyword_id=$id
    #sql_query_post_index    = CALL sphinx_sql_query_post_index('sammydress_keywords', 'sammydress_keywords')

    sql_attr_uint           = cat_id
    sql_attr_uint           = top_cat_id
    sql_attr_uint           = word_count
    sql_attr_uint           = is_delete
    sql_field_string        = keyword
   # sql_field_string  	    = keyword
    sql_attr_uint           = lang
    sql_attr_uint           = goods_num
}
source gearbest_keywords_delta : gearbest_keywords {
    sql_query_pre           = SET NAMES utf8
    sql_query_pre           = UPDATE eload_sphinx_counter SET begin_time=UNIX_TIMESTAMP() WHERE index_name='sammydress_keywords'
    #sql_query_post_index    = CALL sphinx_sql_query_post_index('sammydress_keywords', 'sammydress_keywords_delta')
    sql_query               = \
                            SELECT keyword_id,SUBSTRING(keyword,1,1) AS first_letter,keyword,lang,cat_id,top_cat_id,goods_num,IF(word_count>5, 5, word_count) AS word_count,0 AS is_delete\
                            FROM eload_abc_index_keywords\
                            WHERE last_update_time>(SELECT last_time FROM eload_sphinx_counter WHERE index_name='gearbest_keywords')
}
### 20160419 EE
source gearbest_keywords_seo_fields : gearbest_keywords {
    sql_query_pre           = SET NAMES utf8 
    sql_query               = \
							select ak.keyword_id, ak.cat_id, ak.lang, k.DATE, ak.keyword, k.count \
							from eload_abc_index_keywords as ak left join eload_keywords as k on ak.keyword = k.keyword \
							where length(ak.keyword) > 6 and length(ak.keyword) < 25 and ak.goods_num > 3 

		sql_attr_uint 			= keyword_id		
		sql_attr_uint           = cat_id
		sql_attr_uint        	= lang
		sql_attr_uint           = count
		sql_field_string        = DATE 
		sql_field_string        = keyword 
                            
}

index gearbest_keywords {
    source                  = gearbest_keywords
    path                    = /data/sphinx/var/data/gearbest_keywords
	docinfo                 = extern
    enable_star             = 1
	min_infix_len           = 1
    charset_table           = 0..9, A..Z->a..z, _, a..z, .
    charset_type            = utf-8
	infix_fields            = keyword,lang


}

index gearbest_keywords_delta : gearbest_keywords {
    source                  = gearbest_keywords_delta
    path                    = /data/sphinx/var/data/gearbest_keywords_delta
}
#### 20160419 EE
index gearbest_keywords_seo_fields : gearbest_keywords {
    source                  = gearbest_keywords_seo_fields
    path                    = /usr/local/ver01/sphinx/var/data/gearbest_keywords_seo_fields
	docinfo                 = extern
    enable_star             = 1
	min_infix_len           = 1
    charset_table           = 0..9, A..Z->a..z, _, a..z, .
    charset_type            = utf-8
} 


###
## 用于测试新建索引机制
## 20160411
## --EE
####
source gearbest_SearchBoxDB
{
		type          = mysql
        sql_host      = 127.0.0.1
        sql_user      = sphinx_user
        sql_pass      = 123456
        sql_db        = gearbest_db
        #sql_sock     =  /data/ver01/mysql/var/mysql.sock
        sql_port      = 3306  # optional, default is 3306


		sql_query_pre           = SET NAMES utf8
		sql_query               = \
								SELECT id, keyword,three_count,total_count, cat_id, one_month_count \
								FROM eload_hot_keyword  
		 
		sql_field_string = keyword  
	  	sql_attr_uint	= three_count
		sql_attr_uint	= total_count 
		sql_ranged_throttle	= 0 
		 

}
### 20160419 EE
index gearbestSearchBoxIndex
{
	source			= gearbest_SearchBoxDB

	path			= /data/sphinx/var/data/gearbestSearchBoxIndex

	docinfo			= extern
	enable_star          = 1
    charset_type         = utf-8
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+3E,U+3C
 
}

searchd
{
	port			= 9316
	listen			= 9996:mysql41
	log			= /data/sphinx/var/log/gearbest_searchd.log
	query_log		= /data/sphinx/var/log/gearbest_query.log
	read_timeout		= 5
	max_children		= 30
	pid_file		= /data/sphinx/var/log/gearbest_searchd.pid
	max_matches		= 10000
	seamless_rotate		= 1
	preopen_indexes		= 1
	unlink_old		= 1
        compat_sphinxql_magics  = 0
	workers			= threads # for RT to work
	binlog_path		= /data/sphinx/var/data
	max_batch_queries	= 64
}

# 配置测试海外仓迁移开始fr qiuzoro 20170524
# fr index
source os_gearbest_fr
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
es.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, es.goods_title, es.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, (if(sum(og.stock_amount) > 0,1,0)) as stock_amount,gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
 ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
                FROM eload_goods as g \
                INNER JOIN eload_goods_fr as es on g.goods_id = es.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'fr' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
                INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
                LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND   FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='fr')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint  = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi       = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0

}

# fr index
index os_gearbest_fr
{
    source               =  os_gearbest_fr
    path                 = /data/sphinx/var/data/os_gearbest_fr
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}
# 配置测试海外仓迁移结束fr


# 配置限时限量开始 20170525 qiuzoro
source gearbest_flash_sale
{
        type          = mysql
        sql_host      = 127.0.0.1
        sql_user      = sphinx_user
        sql_pass      = 123456
        sql_db        = gearbest_db
        #sql_sock     =  /data/ver01/mysql/var/mysql.sock
        sql_port      = 3306  # optional, default is 3306
        sql_query_pre = SET NAMES utf8
        sql_query     = \
						SELECT  lt.id, lg.goods_id,og.goods_number,og.is_on_sale,lg.is_status,g.cat_id,g.goods_title,g.goods_sn,lg.addtime,og.shop_price,g.sort_order,g.add_time as os_add_time, g.week2sale,(og.market_price - lt.lgt_price)/og.market_price as limit_zhekou ,lt.limit_end_time,lt.limit_start_time \
						FROM eload_limit_goods AS lg \
						LEFT JOIN eload_limit_goods_times AS lt ON lg.id = lt.limit_id \
						LEFT JOIN eload_os_new_warehouse AS osw ON lg.wid = osw.wid \
						LEFT JOIN eload_goods AS g ON lg.goods_sn = g.goods_sn \
						LEFT JOIN eload_os_goods AS og ON g.goods_id = og.goods_id AND lg.wid = og.wid \
						WHERE lg.is_status = 1 \
							AND lg.is_delete = 0 \
							AND og.goods_number > 0 \
							AND og.is_on_sale = 1 \
							AND lt.limit_end_time >= unix_timestamp() \

		sql_attr_timestamp   = addtime
		sql_attr_timestamp   = limit_end_time
		sql_attr_timestamp   = os_add_time
		sql_attr_timestamp   = limit_start_time
		sql_attr_float       = limit_zhekou
		sql_attr_uint        = is_on_sale
		sql_attr_uint        = week2sale
		sql_attr_uint        = goods_number
		sql_attr_uint        = goods_id
		sql_attr_uint        = cat_id
		sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
		sql_field_string     = goods_title
}

index gearbest_flash_sale
{
    source               =  gearbest_flash_sale
    path                 = /data/sphinx/var/data/gearbest_flash_sale
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_title
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+3E,U+3C
}

# 配置限时限量结束


# br source
source os_gearbest_br
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
es.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, es.goods_title, es.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, (if(sum(og.stock_amount) > 0,1,0)) as stock_amount,gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
 ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
                FROM eload_goods as g \
                INNER JOIN eload_goods_br as es on g.goods_id = es.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'br' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
                INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
                LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND   FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='br')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint  = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi       = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0

}

# br index
index os_gearbest_br
{
    source               =  os_gearbest_br
    path                 = /data/sphinx/var/data/os_gearbest_br
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}

# 配置测试海外仓迁移结束


# tr source
source os_gearbest_tr
{
        type                                    = mysql
        sql_host                                = 10.40.6.148
        sql_user                                = sphinx_user
        sql_pass                                = 123456
        sql_db                                  = gearbest_db
       #sql_sock                          =  /data/ver01/mysql/var/mysql.sock
        sql_port                                = 3307  # optional, default is 3306
sql_query_pre = SET NAMES utf8
        sql_query                               = \
select g.goods_id, g.goods_id as goods_id_alias,g.goods_img, ge.yesterday_sale,ge.before_yesterday_sale,ge.avg_rate,ge.youtube,g.goods_grid,ge.review_count, \
if(ge.yesterday_sale>0,(((ge.before_yesterday_sale/ge.yesterday_sale)-1)*100),0) as day_trend_pv, \
case true when og.shop_price<=7 and ge.yesterday_sale>=10 then 1 when og.shop_price>7 and og.shop_price<=20 and ge.yesterday_sale>=5 then 1 \
when og.shop_price>20 and ge.yesterday_sale>=3 then 1 else 0 end as is_show_trending, \
es.sub_title,url_title,is_24h_ship,g.goods_sn,og.promote_end_date,og.promote_start_date, es.goods_title, es.goods_name, ge.recommended_level, g.goods_brief, g.add_time,og.last_update, g.sort_order, g.group_goods_id, g.point_rate, g.attention_num,og.presale_type, \
                      g.is_free_shipping,og.presale_date_from,og.presale_date_to, g.is_hot,g.is_new,g.is_cool,g.is_fun, og.is_promote, g.week2sale,ge.three_day_sale,g.click_count, og.shop_price, g.is_login, g.cat_id, \
if((sum(og.goods_number >0 and og.is_on_sale) >0),1,0) as goods_number,(if(ge.stock_id_str != '',1,0)) as is_stock, (if(sum(og.stock_amount) > 0,1,0)) as stock_amount,gc.conversion_rate,gc.conversion_rate2,ge.goods_grade,ge.facebook_like_count, \
 ge.recommended_time,ge.shelf_down_type, ge.clearance_discount,ge.goods_brand,ge.brand_name, ge.clearance_date, date_format(from_unixtime(`og`.`add_time`),'%Y%m%d') AS `add_date`, \
(if(sum(og.is_on_sale) = 0 OR is_delete = 1,0,1)) as is_on_dispaly, \
 CONCAT_WS(' ',g.goods_title,GROUP_CONCAT(gal.attr_value separator ' '),replace(replace(g.goods_search_attr,',',''),'_',' ')) AS goods_title_color_size,replace(ge.goods_model,'|',' ') AS goods_model, \
                       ge.review_count AS reviews,ge.is_shot, CONCAT_WS(' ',g.goods_search_attr,CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',')) AS goods_attr,(if(g.is_cool = 1 OR g.is_fun = 1 OR g.cat_id in (11265,11269,11272,11274,11275,11277,11258,11260,11234,11241,11242),1,0)) as get_it_free, \
                       CONCAT(IF(og.promote_start_date<UNIX_TIMESTAMP() AND og.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100),0) WHEN sum(og.stock_amount) = 0 THEN IF (ge.yesterday_sale > 0,(((ge.before_yesterday_sale / ge.yesterday_sale) - 1) * 100 - outday.outday),0) \
END AS is_show_trending_new, \
IF ((sum(og.is_on_sale) = sum(og.presale_type = 4 AND og.is_on_sale)),1,0) \
AS is_clearance, \
CASE TRUE WHEN sum(og.stock_amount) > 0 THEN g.week2sale WHEN sum(og.stock_amount) <= 0 AND outday.outday <= 7 THEN g.week2sale * 0.9 WHEN sum(og.stock_amount) <= 0 AND outday.outday >7 AND outday.outday <= 14 THEN g.week2sale * 0.8 WHEN sum(og.stock_amount) <= 0 AND outday.outday >14 AND outday.outday <= 21 THEN g.week2sale * 0.7 WHEN sum(og.stock_amount) <= 0 AND outday.outday > 21 THEN g.week2sale * 0.6 \
END AS week2sale_new \
                FROM eload_goods as g \
                INNER JOIN eload_goods_tr as es on g.goods_id = es.goods_id \
                LEFT JOIN eload_goods_extend as ge ON g.goods_id = ge.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
                LEFT JOIN eload_goods_attr_language AS gal ON ga.attr_id = gal.attr_id AND ga.attr_value = gal.attr_value AND gal.lang = 'tr' \
                LEFT JOIN eload_goods_conversion_rate AS gc ON g.goods_id=gc.goods_id \
                INNER JOIN eload_os_goods og on g.goods_id = og.goods_id \
                LEFT JOIN eload_goods_outday outday ON g.goods_sn = outday.goods_sn \
                WHERE g.is_alone_sale = 1  AND   FIND_IN_SET(og.wid,(select TRIM(available_ship_wid) from eload_country_site s where s.region_code='tr')) GROUP BY g.goods_id

sql_attr_timestamp   = add_time
sql_attr_timestamp   = promote_end_date
sql_attr_timestamp   = promote_start_date
sql_attr_timestamp   = presale_date_from
sql_attr_timestamp   = presale_date_to
sql_attr_timestamp   = recommended_time
sql_attr_uint        = shelf_down_type
sql_attr_uint        = clearance_date
sql_attr_uint        = add_date
sql_attr_uint        = is_cool
sql_attr_uint        = is_fun
sql_attr_uint        = get_it_free
sql_attr_uint        = is_shot
sql_attr_float    =clearance_discount
sql_attr_timestamp   = last_update
sql_attr_float  = conversion_rate
sql_attr_float  = conversion_rate2
sql_attr_uint    = is_24h_ship
sql_attr_uint   = sort_order
sql_attr_uint    =goods_grade
sql_attr_uint    = goods_number
sql_attr_uint    = stock_amount
sql_attr_uint    = is_on_dispaly
sql_attr_uint    = group_goods_id
sql_attr_float    = point_rate
sql_attr_uint    = is_free_shipping
sql_attr_uint   = recommended_level
sql_attr_uint    = is_hot
# sql_attr_uint  = is_new_promote
sql_attr_uint    = reviews
sql_attr_uint    = week2sale
sql_attr_uint    = three_day_sale
sql_attr_uint    = click_count
sql_attr_float    =shop_price
sql_attr_uint    = is_login
sql_attr_uint    =cat_id
sql_attr_uint    =is_new
sql_attr_uint    =is_promote
sql_attr_uint    =hot_order
sql_attr_uint    = attention_num
sql_attr_uint    = is_stock
sql_attr_uint    = presale_type
sql_field_string  = sub_title
sql_attr_uint    =facebook_like_count
sql_field_string  = goods_sn
sql_field_string  = goods_img
sql_field_string  = goods_title
sql_field_string  = goods_model
sql_field_string  = url_title
sql_field_string  = goods_brand
sql_field_string  = brand_name
sql_attr_float   = day_trend_pv
sql_attr_uint    = is_show_trending
sql_attr_float  = week2sale_new
sql_attr_float  = is_show_trending_new
sql_attr_uint = is_clearance
sql_attr_float  = avg_rate
sql_attr_string = youtube
sql_attr_string = goods_grid
sql_attr_uint   = review_count

sql_attr_multi       = uint store_id from query; SELECT og.goods_id,og.store_id FROM eload_os_goods og JOIN eload_goods g ON og.goods_id=g.goods_id WHERE og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
sql_attr_multi       = uint m_stock_id from query; SELECT goods_id,stock_id FROM eload_goods_stock WHERE goods_stock>0
sql_attr_multi       = uint wid_all from query; SELECT goods_id,wid FROM eload_os_goods WHERE is_on_sale>0
sql_attr_multi       = uint wid from query; SELECT og.goods_id,og.wid FROM eload_os_goods og JOIN eload_os_new_warehouse ow ON og.wid=ow.wid JOIN eload_goods g ON og.goods_id=g.goods_id WHERE ow.is_open=1 AND og.is_on_sale=1 AND og.goods_number>0 AND g.is_delete=0 UNION SELECT goods_id,1 FROM eload_goods WHERE is_on_sale=1 AND goods_number>0 AND is_delete=0
sql_attr_uint = goods_id_alias
sql_attr_multi       = uint crc32 from query; SELECT goods_id,crc32 FROM eload_goods_desc_info where crc32 >0

}

# tr index
index os_gearbest_tr
{
    source               =  os_gearbest_tr
    path                 = /data/sphinx/var/data/os_gearbest_tr
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = goods_sn,goods_brief,goods_title,goods_name,goods_title_color_size,sub_title,presale_type,goods_model,goods_brand,brand_name
    min_infix_len        = 1
    charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+43,U+26,U+28,U+29,U+2F,U+2D,U+410..U+42F->U+430..U+44F,U+430..U+458,U+0401->U+0435,U+0451->U+0435,U+0451->U+0435,U+0407->U+0457,U+0406->U+0456,U+0404->U+0454,U+00C0->a,U+00C1->a,U+00C2->a,U+00C3->a,U+00C4->a,U+00C5->a,U+00C7->c,U+00C8->e,U+00C9->e,U+00CA->e,U+00CB->e,U+00CC->i,U+00CD->i,U+00CE->i,U+00CF->i,U+00D1->n,U+00D2->o,U+00D3->o,U+00D4->o,U+00D5->o,U+00D6->o,U+00D9->u,U+00DA->u,U+00DB->u,U+00DC->u,U+00DD->y,U+00E0->a,U+00E1->a,U+00E2->a,U+00E3->a,U+00E4->a,U+00E5->a,U+00E7->c,U+00E8->e,U+00E9->e,U+00EA->e,U+00EB->e,U+00EC->i,U+00ED->i,U+00EE->i,U+00EF->i,U+00F1->n,U+00F2->o,U+00F3->o,U+00F4->o,U+00F5->o,U+00F6->o,U+00F9->u,U+00FA->u,U+00FB->u,U+00FC->u,U+00FD->y,U+00FF->y,U+0100->a,U+0101->a,U+0102->a,U+0103->a,U+0104->a,U+0105->a,U+0106->c,U+0107->c,U+0108->c,U+0109->c,U+010A->c,U+010B->c,U+010C->c,U+010D->c,U+010E->d,U+010F->d,U+0112->e,U+0113->e,U+0114->e,U+0115->e,U+0116->e,U+0117->e,U+0118->e,U+0119->e,U+011A->e,U+011B->e,U+011C->g,U+011D->g,U+011E->g,U+011F->g,U+0120->g,U+0121->g,U+0122->g,U+0123->g,U+0124->h,U+0125->h,U+0128->i,U+0129->i,U+012A->i,U+012B->i,U+012C->i,U+012D->i,U+012E->i,U+012F->i,U+0130->i,U+0134->j,U+0135->j,U+0136->k,U+0137->k,U+0139->l,U+013A->l,U+013B->l,U+013C->l,U+013D->l,U+013E->l,U+0142->l,U+0143->n,U+0144->n,U+0145->n,U+0146->n,U+0147->n,U+0148->n,U+014C->o,U+014D->o,U+014E->o,U+014F->o,U+0150->o,U+0151->o,U+0154->r,U+0155->r,U+0156->r,U+0157->r,U+0158->r,U+0159->r,U+015A->s,U+015B->s,U+015C->s,U+015D->s,U+015E->s,U+015F->s,U+0160->s,U+0161->s,U+0162->t,U+0163->t,U+0164->t,U+0165->t,U+0168->u,U+0169->u,U+016A->u,U+016B->u,U+016C->u,U+016D->u,U+016E->u,U+016F->u,U+0170->u,U+0171->u,U+0172->u,U+0173->u,U+0174->w,U+0175->w,U+0176->y,U+0177->y,U+0178->y,U+0179->z,U+017A->z,U+017B->z,U+017C->z,U+017D->z,U+017E->z,U+01A0->o,U+01A1->o,U+01AF->u,U+01B0->u,U+01CD->a,U+01CE->a,U+01CF->i,U+01D0->i,U+01D1->o,U+01D2->o,U+01D3->u,U+01D4->u,U+01D5->u,U+01D6->u,U+01D7->u,U+01D8->u,U+01D9->u,U+01DA->u,U+01DB->u,U+01DC->u,U+01DE->a,U+01DF->a,U+01E0->a,U+01E1->a,U+01E6->g,U+01E7->g,U+01E8->k,U+01E9->k,U+01EA->o,U+01EB->o,U+01EC->o,U+01ED->o,U+01F0->j,U+01F4->g,U+01F5->g,U+01F8->n,U+01F9->n,U+01FA->a,U+01FB->a,U+0200->a,U+0201->a,U+0202->a,U+0203->a,U+0204->e,U+0205->e,U+0206->e,U+0207->e,U+0208->i,U+0209->i,U+020A->i,U+020B->i,U+020C->o,U+020D->o,U+020E->o,U+020F->o,U+0210->r,U+0211->r,U+0212->r,U+0213->r,U+0214->u,U+0215->u,U+0216->u,U+0217->u,U+0218->s,U+0219->s,U+021A->t,U+021B->t,U+021E->h,U+021F->h,U+0226->a,U+0227->a,U+0228->e,U+0229->e,U+022A->o,U+022B->o,U+022C->o,U+022D->o,U+022E->o,U+022F->o,U+0230->o,U+0231->o,U+0232->y,U+0233->y,U+1E00->a,U+1E01->a,U+1E02->b,U+1E03->b,U+1E04->b,U+1E05->b,U+1E06->b,U+1E07->b,U+1E08->c,U+1E09->c,U+1E0A->d,U+1E0B->d,U+1E0C->d,U+1E0D->d,U+1E0E->d,U+1E0F->d,U+1E10->d,U+1E11->d,U+1E12->d,U+1E13->d,U+1E14->e,U+1E15->e,U+1E16->e,U+1E17->e,U+1E18->e,U+1E19->e,U+1E1A->e,U+1E1B->e,U+1E1C->e,U+1E1D->e,U+1E1E->f,U+1E1F->f,U+1E20->g,U+1E21->g,U+1E22->h,U+1E23->h,U+1E24->h,U+1E25->h,U+1E26->h,U+1E27->h,U+1E28->h,U+1E29->h,U+1E2A->h,U+1E2B->h,U+1E2C->i,U+1E2D->i,U+1E2E->i,U+1E2F->i,U+1E30->k,U+1E31->k,U+1E32->k,U+1E33->k,U+1E34->k,U+1E35->k,U+1E36->l,U+1E37->l,U+1E38->l,U+1E39->l,U+1E3A->l,U+1E3B->l,U+1E3C->l,U+1E3D->l,U+1E3E->m,U+1E3F->m,U+1E40->m,U+1E41->m,U+1E42->m,U+1E43->m,U+1E44->n,U+1E45->n,U+1E46->n,U+1E47->n,U+1E48->n,U+1E49->n,U+1E4A->n,U+1E4B->n,U+1E4C->o,U+1E4D->o,U+1E4E->o,U+1E4F->o,U+1E50->o,U+1E51->o,U+1E52->o,U+1E53->o,U+1E54->p,U+1E55->p,U+1E56->p,U+1E57->p,U+1E58->r,U+1E59->r,U+1E5A->r,U+1E5B->r,U+1E5C->r,U+1E5D->r,U+1E5E->r,U+1E5F->r,U+1E60->s,U+1E61->s,U+1E62->s,U+1E63->s,U+1E64->s,U+1E65->s,U+1E66->s,U+1E67->s,U+1E68->s,U+1E69->s,U+1E6A->t,U+1E6B->t,U+1E6C->t,U+1E6D->t,U+1E6E->t,U+1E6F->t,U+1E70->t,U+1E71->t,U+1E72->u,U+1E73->u,U+1E74->u,U+1E75->u,U+1E76->u,U+1E77->u,U+1E78->u,U+1E79->u,U+1E7A->u,U+1E7B->u,U+1E7C->v,U+1E7D->v,U+1E7E->v,U+1E7F->v,U+1E80->w,U+1E81->w,U+1E82->w,U+1E83->w,U+1E84->w,U+1E85->w,U+1E86->w,U+1E87->w,U+1E88->w,U+1E89->w,U+1E8A->x,U+1E8B->x,U+1E8C->x,U+1E8D->x,U+1E8E->y,U+1E8F->y,U+1E96->h,U+1E97->t,U+1E98->w,U+1E99->y,U+1EA0->a,U+1EA1->a,U+1EA2->a,U+1EA3->a,U+1EA4->a,U+1EA5->a,U+1EA6->a,U+1EA7->a,U+1EA8->a,U+1EA9->a,U+1EAA->a,U+1EAB->a,U+1EAC->a,U+1EAD->a,U+1EAE->a,U+1EAF->a,U+1EB0->a,U+1EB1->a,U+1EB2->a,U+1EB3->a,U+1EB4->a,U+1EB5->a,U+1EB6->a,U+1EB7->a,U+1EB8->e,U+1EB9->e,U+1EBA->e,U+1EBB->e,U+1EBC->e,U+1EBD->e,U+1EBE->e,U+1EBF->e,U+1EC0->e,U+1EC1->e,U+1EC2->e,U+1EC3->e,U+1EC4->e,U+1EC5->e,U+1EC6->e,U+1EC7->e,U+1EC8->i,U+1EC9->i,U+1ECA->i,U+1ECB->i,U+1ECC->o,U+1ECD->o,U+1ECE->o,U+1ECF->o,U+1ED0->o,U+1ED1->o,U+1ED2->o,U+1ED3->o,U+1ED4->o,U+1ED5->o,U+1ED6->o,U+1ED7->o,U+1ED8->o,U+1ED9->o,U+1EDA->o,U+1EDB->o,U+1EDC->o,U+1EDD->o,U+1EDE->o,U+1EDF->o,U+1EE0->o,U+1EE1->o,U+1EE2->o,U+1EE3->o,U+1EE4->u,U+1EE5->u,U+1EE6->u,U+1EE7->u,U+1EE8->u,U+1EE9->u,U+1EEA->u,U+1EEB->u,U+1EEC->u,U+1EED->u,U+1EEE->u,U+1EEF->u,U+1EF0->u,U+1EF1->u,U+1EF2->y,U+1EF3->y,U+1EF4->y,U+1EF5->y,U+1EF6->y,U+1EF7->y,U+1EF8->y,U+1EF9->y
}

# 配置测试海外仓迁移结束





indexer {
        mem_limit           = 512M
}
