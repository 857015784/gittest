##volkkauf_de
source volkkaufde
{
        type                    = mysql
 
        sql_host                =  127.0.0.1
        sql_user                = root
        sql_pass                = qazwsx
        sql_db                  = volkkauf_de_db
        sql_port                = 3306 
        sql_sock              = /tmp/mysql.sock 
        sql_query_pre       = SET NAMES UTF8
sql_query                               = \
select g.goods_id, g.goods_sn, g.goods_title,s.goods_grade,g.goods_name, g.goods_brief, g.add_time, g.sort_order, g.group_goods_id, g.point_rate,g.promote_price,g.promote_start_date, g.promote_end_date, g.goods_thumb , g.goods_img,g.goods_grid ,g.url_title,g.goods_type,g.goods_weight,date_format(from_unixtime(`g`.`add_time`),'%Y%m%d') AS `add_date`, \
                       g.is_free_shipping, g.is_hot,g.is_new, g.is_promote, g.week2sale, g.click_count, g.shop_price, g.is_login, g.cat_id, (if(goods_number=0,0,1)) as goods_number,g.market_price ,g.is_on_sale, g.is_delete,\
if (is_new_sn,left(goods_sn,7),goods_sn) as group_goods_sn, \
                      count(DISTINCT rid) AS review_count,sum(rate_overall) as review_rate, CONCAT(',',GROUP_CONCAT(ga.attr_value separator ', ,'),',') AS goods_attr, \
                       CONCAT(IF(g.promote_start_date<UNIX_TIMESTAMP() AND g.promote_end_date>UNIX_TIMESTAMP(), 2, 1), EXISTS(SELECT goods_id FROM eload_goods_tuijian WHERE goods_id=g.goods_id AND (is_best=1 OR is_new=1 OR is_hot=1))) AS hot_order , cg.goods_desc as cat_goods_desc \
                FROM eload_goods as g \
                LEFT JOIN eload_review as r ON r.goods_id = g.goods_id AND r.is_pass = 1 \
                LEFT JOIN eload_goods_state as s ON s.goods_id = g.goods_id \
                LEFT JOIN eload_goods_attr as ga ON g.goods_id = ga.goods_id \
                LEFT JOIN eload_category as cg ON g.cat_id = cg.cat_id \
                WHERE g.is_on_sale=1  AND g.is_delete=0 AND g.is_alone_sale = 1 AND g.goods_thumb != '' GROUP BY g.goods_id

sql_field_string     = goods_title
sql_field_string     = cat_goods_desc
sql_field_string     = goods_name
sql_field_string     = goods_brief
sql_field_string     = goods_sn
sql_attr_string      = goods_thumb
sql_attr_string      = goods_img
sql_attr_string      = goods_grid
sql_attr_uint        = is_on_sale
sql_attr_uint        = is_delete
sql_attr_string      = url_title
sql_attr_float       = promote_price
sql_attr_uint        = promote_start_date
sql_attr_uint        = promote_end_date
sql_attr_uint        = goods_type
sql_attr_timestamp   = add_time
sql_attr_uint        = sort_order
sql_attr_uint        = goods_grade 
sql_attr_uint        = add_date 
sql_attr_uint        = goods_number
sql_attr_uint        = group_goods_id
sql_attr_float       = point_rate
sql_attr_uint        = is_free_shipping
sql_attr_uint        = is_hot
sql_attr_string      = group_goods_sn
sql_attr_uint        = review_count
sql_attr_uint        = week2sale
sql_attr_uint        = click_count
sql_attr_uint        = review_rate
sql_attr_float       = shop_price
sql_attr_float       = market_price
sql_attr_float       = goods_weight
sql_attr_uint        = is_login
sql_attr_uint        = cat_id
sql_attr_uint        = is_new
sql_attr_uint        = is_promote
sql_attr_uint        = hot_order
sql_attr_multi       = uint cat_id_all from query; SELECT goods_id,cat_id FROM (SELECT goods_id,cat_id FROM eload_goods UNION SELECT goods_id,cat_id FROM eload_goods_cat) AS t
}

index volkkauf_de
{
        source                  = volkkaufde
        path                    = /usr/local/sphinx/var/data/volkkauf_de
        docinfo                 = extern
        enable_star             = 1
        charset_type            = utf-8
        infix_fields            = goods_sn,goods_brief,goods_title,goods_name,cat_goods_desc
        min_infix_len        = 1
        charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+C4->U+E4, U+D6->U+F6, U+DC->U+FC, U+DF, U+E4, U+F6, U+FC
}


#VOLKKAUF_ABC
source vde_abckeyword_main
{
        type                                    = mysql
 
        sql_host                                = 127.0.0.1
        sql_user                                = root
        sql_pass                                = qazwsx
        sql_db                                  = volkkauf_de_abc
        #sql_sock               =  /usr/local/mysql/var/mysql.sock
        sql_port                                = 3306  # optional, default is 3306
sql_query_pre = SET NAMES utf8
sql_query                               = \
SELECT id,keyword,other_keyword_id,goods_num,tagsku,no_keyword,goods_num_update_time,in_keyword,custom_keyword,canonicalurl,times,indexupdate_time,title,`desc`,keywords,introduction,cat_id,is_show,referer,url,custom_keyword_new,is_delete,status,update_time,add_time FROM eload_abc_index_keywords
 
sql_attr_string        = title
sql_attr_string        = desc
sql_attr_string        = keywords
sql_attr_string         = tagsku
sql_attr_string         = no_keyword
sql_attr_string         = in_keyword
sql_attr_string         = custom_keyword
sql_attr_string         = custom_keyword_new 
sql_attr_string         = canonicalurl
sql_attr_string        = other_keyword_id
sql_attr_string        = introduction
sql_field_string     = keyword
sql_field_string      = url
sql_attr_string      = status
sql_attr_uint        = cat_id
sql_attr_uint        = is_show
sql_attr_uint        = is_delete
sql_attr_uint        = times
sql_attr_uint        = goods_num
sql_attr_uint        = add_time
sql_attr_uint        = update_time
sql_attr_uint        = goods_num_update_time
sql_attr_uint        = referer
sql_attr_uint        = indexupdate_time

sql_attr_multi       = uint cat_id_all from query; SELECT keyword_id,cat_id FROM eload_abc_index_cat
}
index vde_abckeyword
{
    source               = vde_abckeyword_main
    path                 =  /usr/local/sphinx/var/data/vde_abckeyword
    docinfo              = extern
    enable_star          = 1
    charset_type         = utf-8
    infix_fields         = keyword,goods_num,times,cat_id,is_show,title,desc,keywords,introduction,referer,url,is_delete,add_time,update_time,status,indexupdate_time
    min_infix_len        = 1
#charset_table            = 0..9,A..Z->a..z,a..z,U+2C
charset_table        = 0..9,A..Z->a..z,a..z,U+2C,U+2E,U+2B,U+5F,U+7B,U+7D,U+5E,U+C4->U+E4, U+D6->U+F6, U+DC->U+FC, U+DF, U+E4, U+F6, U+FC

 
}
#VOLKKAUF_ABC_END



indexer
{
	mem_limit		= 512M
}


searchd
{
	port			= 9324

	log			= /usr/local/sphinx/var/log/searchd.log
	query_log		= /usr/local/sphinx/var/log/query.log
	read_timeout		= 5
	max_children		= 30
	pid_file		= /usr/local/sphinx/var/log/searchd.pid
	max_matches		= 20000
	#max_matches		= 2500
	seamless_rotate		= 1
	preopen_indexes		= 1
	unlink_old		= 1
        compat_sphinxql_magics  = 0
	workers			= threads # for RT to work
	binlog_path		= /usr/local/sphinx/var/data
}

